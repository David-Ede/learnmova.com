<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/png" href="assets/images/favicon_8.png" />
<title>MOVA ‚Äî Ukrainain</title>
<style>
  :root{
    --duo-green:#7FE12E; /* original gradient green color #58CC02 */
    --duo-green-2:#7FE12E;
    --duo-dark:#071B0C;
    --color-text:#0e1318;
    --duo-muted:#6b7580;
    --panel:#ffffff;
    --bg:#F7F9FB;
    --border:#E5EAF0;
    --purple:#7c4dff;
    --gold:#ffb300;
    --red:#ff4b4b;
    --blue:#1cb0f6;
    --shadow:0 14px 40px rgba(10,20,30,.08);
    --radius:18px;
    --radius-sm:12px;
    --font: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    /* Primary button color tokens (centralized for theming) */
    --primary-start: #49c1ff;
    --primary-end: #49c1ff;
    --primary-foreground: #000; /* button text color on primary background (black) */
    /* Tip box theme tokens */
    --tip-bg: #fff7e6;
    --tip-border: #ffe0a3;
    --tip-color: var(--color-text);
    /* Primary CTA (Start Next) tokens, used by button and skill ring */
    --cta-start: var(--duo-green);
    --cta-end: var(--duo-green);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --panel:#11161c;
      --bg:#0b1015;
      --color-text:#eaf0f6;
      --duo-muted:#99a3ad;
      --border:#202a35;
      --shadow:0 14px 40px rgba(0,0,0,.45);
      /* Dark defaults for tips when following system */
      --tip-bg:#1e2a33;
      --tip-border:#2b3a46;
      --tip-color: var(--color-text);
    }
  }
  /* Explicit theme overrides via user toggle (takes precedence) */
  [data-theme="light"]{
    --panel:#ffffff;
    --bg:#F7F9FB;
    --color-text:#0e1318;
    --duo-muted:#6b7580;
    --border:#E5EAF0;
    --shadow:0 14px 40px rgba(10,20,30,.08);
    /* Explicit light tips */
    --tip-bg:#fff7e6;
    --tip-border:#ffe0a3;
    --tip-color: var(--color-text);
  }
  [data-theme="dark"]{
    --panel:#11161c;
    --bg:#0b1015;
    --color-text:#eaf0f6;
    --duo-muted:#99a3ad;
    --border:#202a35;
    --shadow:0 14px 40px rgba(0,0,0,.45);
    /* Explicit dark tips */
    --tip-bg:#1e2a33;
    --tip-border:#2b3a46;
    --tip-color: var(--color-text);
  }
  html,body{height:100%}
  body{ margin:0; background:linear-gradient(180deg,var(--bg),var(--bg)); color:var(--color-text); font-family:var(--font); }
  /* Topbar */
  .topbar{
    position:sticky; top:0; z-index:7;
    display:flex; align-items:center; justify-content:space-between;
    gap:12px; padding:12px clamp(14px,3vw,28px);
    background:rgba(255,255,255,.65); backdrop-filter: blur(10px);
    border-bottom:1px solid var(--border);
  }
  @media (prefers-color-scheme: dark){ .topbar{ background:rgba(0,0,0,.25) } }
  .logo{ display:flex; gap:10px; align-items:center; font-weight:900; letter-spacing:.2px }
  .logo-badge{
    width:38px; height:24px; border-radius:6px;
    background: linear-gradient(180deg, #005bbb 0% 50%, #ffd500 50% 100%);
    border:2px solid #ffffff;
    box-shadow: 0 4px 10px rgba(0,0,0,.12);
    cursor:pointer;
  }
  .topbar .stats{ display:flex; gap:12px; align-items:center }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-weight:700;
    background:var(--panel);
  }
  .pill.heart{ color:#e91e63 } .pill.xp{ color:var(--duo-green) } .pill.streak{ color:#ff6f00 }
  .tabbar{ display:flex; gap:6px; align-items:center }
  .tab{ border:none; background:transparent; padding:10px 12px; border-radius:12px; font-weight:800; cursor:pointer }
  /* Tabs: text color follows theme; outline indicates selection */
  .topbar .tab{ color: var(--color-text) }
  /* Active tab: blue outline for clear selection */
  .tab.active{ background:transparent; border:none; outline:2px solid var(--primary-start); outline-offset:2px; color:var(--color-text) }
  .btn{ border:none; font-weight:900; letter-spacing:.2px; padding:12px 16px; border-radius:14px; cursor:pointer }
.btn.primary{ background: linear-gradient(180deg, var(--cta-start), var(--cta-end)); color:#fff; box-shadow:0 10px 20px rgba(88,204,2,.25) }
  .btn.blue{ background: linear-gradient(180deg, var(--primary-start), var(--primary-end)); color: var(--primary-foreground) }
  /* Make sure primary button foreground stays the designated color in dark theme too */
  [data-theme="dark"] .btn.blue{ color: var(--primary-foreground) }
  @media (prefers-color-scheme: dark){ .btn.blue{ color: var(--primary-foreground) } }
  .btn.ghost{ background:transparent; border:2px solid var(--border) }
  .btn.red{ background: linear-gradient(180deg, #ff6a6a, #ff4b4b); color:#fff }
  .btn:disabled{ opacity:.6; cursor:not-allowed }
  /* Ensure buttons use the shared text color variable */
  #btnOpenGrammar{ color: var(--color-text) }
  #btnCheck{ color: var(--color-text) }
  /* Library Clear button should follow theme text color (light/dark) */
  #libClear{ color: var(--color-text) }
  /* Ensure practice action buttons use the centralized primary foreground (always black) */
  #btnToddler{ color: var(--primary-foreground) }
  #btnVocab{ color: var(--primary-foreground) }
  #btnAudio{ color: var(--primary-foreground) }
  #btnReading{ color: var(--primary-foreground) }
  #btnGrammar{ color: var(--primary-foreground) }
  /* Tips button in skill cards should follow theme text color */
  .btn.ghost.btnTips{ color: var(--color-text) }
  /* Make some button text always black regardless of theme */
  #btnStartNext{ color:#000 }
  #btnAlphabetIntro{ color:#000 }
  /* Ensure the Alphabet modal Start button has black text (use a more specific selector instead of !important) */
  .modal .actions .btn.primary#alphStart{ color: var(--primary-foreground) }
  /* Ensure the in-lesson Alphabet 'Check' and 'Continue' buttons are black in both light and dark themes */
  .modal #alphLessonView .actions .btn.primary#alphCheck{ color: var(--primary-foreground) }
  .modal #alphLessonView .actions .btn.primary#alphContinue{ color: var(--primary-foreground) }
  /* Force CHECK/CONTINUE button text to black (do not invert with theme) */
  #alphLessonView .actions .btn.primary#alphCheck, #alphLessonView .actions .btn.primary#alphContinue{ color: #000 }
  #btnprimary{ color:#000 }
  .btn.blue.btnStartSkill{ color:#000 }
  .toggle{ display:inline-flex; align-items:center; gap:8px; font-weight:700 }
  .toggle input{ width:42px; height:22px }
  /* hide legacy mobile toggle (we'll use an automatic bottom nav on mobile) */
  #btnNavToggle{ display:none; }

  /* Views */
  main{ max-width:1150px; margin:16px auto; padding:0 clamp(14px,3vw,28px) 90px; }
  .view{ display:none; } .view.active{ display:block; }

  /* Home */
  .home-hero{ display:grid; grid-template-columns: 1.1fr .9fr; gap:16px; align-items:center; }
  @media (max-width:900px){ .home-hero{ grid-template-columns:1fr } }
  .start-card{
    background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
    padding:18px; display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center;
  }
  .start-card .icon{ font-size:2rem }
  /* Hide legacy start card; replaced by Alphabet module */
  .start-card{ display:none }
  /* Alphabet module styles */
  .alph-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap:8px; margin-top:10px }
  .alph-btn{ display:grid; gap:6px; align-items:center; justify-items:center; padding:10px; border:2px solid var(--border); border-radius:12px; background:linear-gradient(180deg, rgba(127,127,127,.06), rgba(127,127,127,.03)); cursor:pointer }
  /* Use theme-aware text color so letters are visible in light and dark themes */
  .alph-btn .letters{ font-weight:900; font-size:1.2rem; color:var(--color-text) }
  .alph-btn .trans{ font-size:.9rem; color:var(--duo-muted) }
  .alph-btn:active{ transform:scale(.98) }
  .alph-head{ display:flex; align-items:center; justify-content:space-between; gap:10px }
  .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:50 }
  .overlay.open{ display:flex }
  .modal{ width:min(720px, 92vw); max-height:90vh; overflow:auto; background:var(--panel); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:18px; }
  /* allow positioning of an inner close button */
  .modal{ position:relative; }
  .modal .title{ font-weight:900; font-size:1.3rem; margin-bottom:8px }
  .modal .muted{ color:var(--duo-muted) }
  .modal .actions{ display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:12px }
  .alph-bigletter{ font-size:5rem; text-align:center; margin:10px 0 }
  .alph-bigletter .ua{ display:block }
  .alph-bigletter .phonetic{ font-size:1.05rem; color:var(--duo-muted); margin-top:6px }
  /* hide the phonetic text inside the lesson view (keep in DOM for a11y or reuse) */
  #alphLessonView .phonetic{ display:none }
  /* leave space on the left so the close X doesn't overlap the progress bar */
  #alphLessonView .progress{ margin-left:56px; margin-right:12px }

  /* Option buttons (phonetics) */
  .alph-options{ display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:8px; margin-top:12px }
  .alph-option{ padding:12px 14px; border:2px solid var(--border); border-radius:12px; background: linear-gradient(180deg, rgba(127,127,127,.03), rgba(127,127,127,.01)); cursor:pointer; font-weight:800; text-align:center; color:var(--color-text) }
  .alph-option.selected{ border-color: var(--blue); box-shadow: 0 6px 18px rgba(28,176,246,.12); }
  .alph-option.correct{ border-color: var(--duo-green); background: linear-gradient(180deg, rgba(127,255,127,.06), rgba(127,255,127,.02)) }
  .alph-option.wrong{ border-color: var(--red); background: linear-gradient(180deg, rgba(255,127,127,.04), rgba(255,127,127,.02)) }
  .alph-option:disabled{ opacity:.5; cursor:not-allowed }

  /* Top-left X button inside the modal for closing the lesson and returning home */
  .modal .modal-close-lesson{
    position:absolute; top:12px; left:12px; border:1px solid var(--border); background:transparent; color:var(--duo-muted);
    padding:6px 8px; border-radius:8px; cursor:pointer; font-weight:800;
  }
  .modal .modal-close-lesson:hover{ filter:brightness(1.06) }
  .progress{ height:8px; background:#e5eaf0; border-radius:6px; overflow:hidden }
  .progress > div{ height:100%; background:var(--blue); width:0 }
  /* Toast variations for feedback popups */
  .toast.success{ background: var(--duo-green); color: #000 }
  .toast.error{ background: var(--red); color: #fff }
  /* Ensure Close button in Alphabet overlay has strong contrast */
  #alphClose{ background:#1f2a37; color:#fff; border-color:#2b3a46 }
  #alphClose:hover{ filter:brightness(1.08) }
  .ring{
    --size:52px; width:var(--size); height:var(--size); border-radius:50%;
    background: conic-gradient(var(--duo-green) var(--p,0%), #cfd8dc 0);
    display:grid; place-items:center; color:#fff; font-weight:900; box-shadow: inset 0 0 0 4px rgba(255,255,255,.4);
  }
  /* Force the dailyRing number to always be black */
  #dailyRing{ color:#000 }
  .goal{ display:flex; gap:10px; align-items:center; justify-content:flex-end }
  .goal .mini{ font-size:.85rem; color:var(--duo-muted) }

  .path-grid{ display:grid; grid-template-columns: repeat(5, 1fr); gap:20px; margin-top:16px }
  @media (max-width:980px){ .path-grid{ grid-template-columns: repeat(4, 1fr) } }
  @media (max-width:740px){ .path-grid{ grid-template-columns: repeat(3, 1fr) } }
  .skill{ position:relative; display:grid; justify-items:center; gap:10px; text-align:center; }
  .node{
    width:100px; height:100px; border-radius:50%; background:var(--panel);
    border:2px solid var(--cta-end); box-shadow: var(--shadow);
    display:grid; place-items:center; position:relative; transition: transform .12s ease; cursor:pointer;
  }
  .node:hover{ transform: translateY(-2px) }
  .node.locked{ opacity:.45; filter:grayscale(1); border-style:dashed; cursor:not-allowed }
  .node .emoji{ font-size:2rem }
  .node .crown{ position:absolute; top:-8px; right:-6px; font-size:1.1rem; filter: drop-shadow(0 4px 10px rgba(0,0,0,.25)); }
  .skill .name{ font-weight:800; font-size:.95rem }
  .skill .meta{ color:var(--duo-muted); font-size:.85rem }
  .skill .start-mini{ display:flex; gap:8px }

  /* Lesson */
  .lesson-wrap{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; max-width:950px; margin:0 auto; position:relative; }
  .lesson-top{ display:flex; justify-content:space-between; gap:10px; align-items:center; margin-bottom:10px; }
  .segments{ display:flex; gap:6px; } .seg{ width:26px; height:10px; border-radius:6px; background:#dfe7ee; border:1px solid var(--border) } .seg.done{ background:var(--duo-green) } .seg.fail{ background:var(--red) }
  .hearts{ display:flex; gap:6px } .hearts .h{ width:20px; height:18px; background: #ffd1d8; border:1px solid #ff99a8; border-radius:5px; } .hearts .h.on{ background:#ff648a; border-color:#ff2d55 }
  .prompt{ font-size: clamp(1.2rem, 2.2vw, 1.8rem); font-weight:900; display:flex; align-items:center; gap:10px; }
  .prompt .speak{ border:1px solid var(--border); border-radius:10px; padding:6px 10px; cursor:pointer }
  .prompt .mini{ color:var(--duo-muted); font-size:.9rem; font-weight:700 }
  .muted{ color:var(--duo-muted) }
  .mc-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px; margin-top:10px }
  .opt{ text-align:left; padding:12px 14px; border:2px solid var(--border); border-radius:14px; background:linear-gradient(180deg, rgba(127,127,127,.04), rgba(127,127,127,.02)); font-size:1.05rem; transition:border .15s, transform .05s; color: var(--duo-dark); cursor:pointer }
  @media (prefers-color-scheme: dark){ .opt{ color:#fff } }
  /* Theme-aware option & chip styles for readable contrast in both themes */
  /* Light theme: dark text on light backgrounds */
  [data-theme="light"] .opt{
    background: linear-gradient(180deg, #ffffff, #f7fbff);
    color: #0e1318;
    border-color: var(--border);
  }
  [data-theme="light"] .chip{
    background: #f2f6fa; color: #0e1318; border-color: var(--border);
  }
  /* Dark theme: light text on subtly lighter dark panels for contrast */
  [data-theme="dark"] .opt{
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    color: var(--color-text);
    border-color: var(--border);
  }
  [data-theme="dark"] .chip{
    background: rgba(255,255,255,0.03); color: var(--color-text); border-color: var(--border);
  }
  /* Fall back to OS preferences when data-theme isn't explicitly set */
  @media (prefers-color-scheme: light){ .opt{ background: linear-gradient(180deg, #ffffff, #f7fbff); color:#0e1318; } .chip{ background:#f2f6fa; color:#0e1318 } }
  @media (prefers-color-scheme: dark){ .opt{ background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); color:var(--color-text); } .chip{ background:rgba(255,255,255,0.03); color:var(--color-text) } }
  .opt:hover{ transform:translateY(-1px) } .opt.selected{ border-color: var(--blue) } .opt.correct{ border-color: var(--duo-green) } .opt.wrong{ border-color: var(--red) }
  .wb-bank, .wb-answer{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px }
  .chip{ border:1px solid var(--border); border-radius:10px; padding:8px 10px; background:#f2f6fa; font-weight:700; cursor:pointer }
  .chip.used{ opacity:.4; pointer-events:none }
  .feedback{ border-left:4px solid var(--border); padding:10px 12px; border-radius:10px; background:#f3f7fb; margin-top:10px }
  .feedback.good{ border-left-color: var(--duo-green); background: #e5f7dc }
  .feedback.bad{ border-left-color: var(--red); background: #ffe8ea }
  .feedback.info{ border-left-color: var(--blue); background:#e6f4ff }
  .action-bar{ display:flex; gap:10px; align-items:center; margin-top:8px; flex-wrap:wrap }

  /* Media task (Animal card) */
  .mediaArea{ display:grid; place-items:center; margin:12px 0 6px }
  .animalBtn{
    width: 180px; height: 180px; border-radius: 28px; border: 2px dashed var(--border);
    display:grid; place-items:center; font-size: 6rem; background: linear-gradient(180deg, rgba(127,127,127,.04), rgba(127,127,127,.02));
    user-select: none; box-shadow: var(--shadow); cursor: pointer;
  }
  .animalBtn:active{ transform: scale(.98) }
  .animalHint{ font-size:.9rem; color:var(--duo-muted); margin-top:6px }

  /* Grammar Panel (in-lesson) */
  .gpanel{ position: fixed; right: 0; top: 64px; bottom: 0; width: 420px; max-width: 92vw; background: var(--panel); border-left:1px solid var(--border); box-shadow: -10px 0 30px rgba(0,0,0,.08); transform: translateX(105%); transition: transform .18s ease; z-index: 8; display:grid; grid-template-rows:auto 1fr auto }
  .gpanel.open{ transform: translateX(0); }
  .gph{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:12px; border-bottom:1px solid var(--border); }
  .gpb{ padding:12px; overflow:auto }
  .gpf{ padding:10px 12px; border-top:1px solid var(--border); display:flex; gap:8px; align-items:center; justify-content:space-between; }
  .gptitle{ font-weight:900 }
  .small{ font-size:.85rem; color:var(--duo-muted) }
  .tipbox{ background: var(--tip-bg); border:1px solid var(--tip-border); color: var(--tip-color); border-radius:10px; padding:10px; }
  table.tbl{ width:100%; border-collapse:collapse; }
  table.tbl th,table.tbl td{ border:1px solid var(--border); padding:6px 8px; text-align:left }
  table.tbl th{ background:#f3f7fb }

  /* Grammar HUB (full view) */
  .grid-cards{ display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; }
  @media (max-width:900px){ .grid-cards{ grid-template-columns: repeat(2, 1fr) } }
  @media (max-width:620px){ .grid-cards{ grid-template-columns: 1fr } }
  .card{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; display:grid; gap:10px; }
  .card .title{ font-weight:900; display:flex; align-items:center; gap:8px }
  .card .muted{ line-height:1.4 }
  .searchbar{ display:flex; gap:8px; margin:10px 0 }
  .searchbar input{ flex:1; padding:10px 12px; border:1px solid var(--border); border-radius:10px; font:inherit }

  /* Library */
  .deck-list{ display:grid; gap:8px; max-height:60vh; overflow:auto; }
  .deck-item{ display:grid; grid-template-columns: 1fr auto auto; gap:8px; align-items:center; padding:10px; border:1px solid var(--border); border-radius:12px; }
  .badge{ font-size:.8rem; border:1px solid var(--border); padding:3px 8px; border-radius:999px; color:var(--duo-muted) }
  footer{ padding:24px; color:var(--duo-muted); text-align:center }

  /* Practice buttons should use the shared .btn.blue class; no per-view overrides */
  #grammar .btn{ color: #000 }

  /* Library uses the shared .btn.blue class; no library-specific overrides needed */

  /* Mini toast */
  .toast{ position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#111; color:#fff; padding:10px 14px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.3); opacity:0; transition:opacity .2s, transform .2s; z-index:20; }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px); }
  /* Dark-mode contrast fixes for light components */
  @media (prefers-color-scheme: dark){
    .feedback{ background:#1a2430 }
    /* tipbox uses theme variables; explicit values covered by vars */
  }

  /* Ensure Check button text is always black (primary green background keeps contrast) */
  #btnCheck, .btn.primary#btnCheck{ color: #000 }

  /* Position the action bar relatively so feedback can be placed next to buttons without covering options */
  .action-bar{ position: relative }
  .action-group{ display:inline-flex; gap:8px; align-items:center; position:relative }
  /* Place feedback to the left of the action-group so it doesn't overlap options; anchored inside action-bar */
  .action-bar .feedback{
    position: absolute;
    right: auto;
    left: calc(100% - 420px); /* fallback - try to position left of the buttons */
    bottom: 0; transform: translateX(-100%);
    width: auto; min-width: 200px; max-width: 360px;
    z-index: 20; margin:0; color: #000; box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    border-radius: 10px; padding: 10px 12px; background: #fff;
  }
  /* If there's insufficient space, use right alignment fallback */
  @media (max-width:700px){ .action-bar .feedback{ left: auto; right: 0; transform: translateX(0); bottom: 46px } }
  .action-bar .feedback.good{ border-left-color: var(--duo-green); background: #e5f7dc }
  .action-bar .feedback.bad{ border-left-color: var(--red); background: #ffe8ea }
  .action-bar .feedback.info{ border-left-color: var(--blue); background:#e6f4ff }
  /* Keep message text black in dark theme for legibility */
  [data-theme="dark"] .action-bar .feedback{ color:#000 }
  @media (prefers-color-scheme: dark){ .action-bar .feedback{ color:#000 } }
  /* Ensure muted text inside feedback is high-contrast (e.g., 'Answer: you') */
  .action-bar .feedback .muted{ color: #0e1318; opacity: 1; font-weight: 700 }

/* Mobile & small-screen adjustments */
@media (max-width:700px){
  :root{ --radius:14px; --radius-sm:10px; }
  body{ font-size:15px; }
  .topbar{ padding:8px 12px; gap:8px; }
  .logo{ font-size:1rem }
  .logo-badge{ width:34px; height:20px }
  .tabbar{ display:none; position:absolute; left:0; right:0; top:56px; background:var(--panel); border-bottom:1px solid var(--border); padding:8px; gap:8px; flex-wrap:wrap; z-index:30 }
  .stats{ display:none }
  body.nav-open .tabbar{ display:flex; flex-direction:row; justify-content:flex-start; gap:6px }
  /* make touch targets larger */
  .btn{ padding:14px 16px; border-radius:12px; }
  .alph-grid{ grid-template-columns: repeat(auto-fill, minmax(72px, 1fr)); gap:8px }
  .node{ width:84px; height:84px }
  .path-grid{ gap:12px }
  main{ padding-bottom:20px }
  .modal{ width:94vw; max-height: calc(100vh - 36px); border-radius:12px }
  /* Grammar panel becomes bottom sheet on mobile */
  .gpanel{ top:auto; bottom:0; left:0; right:0; width:100%; height:72vh; transform: translateY(105%); border-left:none; box-shadow:0 -10px 30px rgba(0,0,0,.35); }
  .gpanel.open{ transform: translateY(0); }
  /* place modal close button consistent with mobile */
  .modal .modal-close-lesson{ left:8px; top:8px }
  /* action bar feedback fallback for small screens */
  .action-bar .feedback{ left:auto; right:0; transform:translateX(0); bottom:64px }
}

/* Small tweak for very small phones */
@media (max-width:420px){
  .home-hero{ gap:10px }
  .prompt{ font-size: clamp(1rem, 3.6vw, 1.4rem) }
  .alph-bigletter{ font-size:3.2rem }
}

/* Bottom navigation styles */
.bottom-nav{ display:none; position:fixed; left:0; right:0; bottom:0; height:64px; background:linear-gradient(180deg,var(--panel),var(--panel)); border-top:1px solid var(--border); display:flex; gap:6px; padding:6px 10px; align-items:center; justify-content:space-around; z-index:40 }
.bottom-nav .nav-btn{ background:transparent; border:none; display:flex; flex-direction:column; align-items:center; gap:4px; padding:6px 8px; border-radius:10px; color:var(--duo-muted); font-weight:800; cursor:pointer }
.bottom-nav .nav-btn .nav-icon{ font-size:1.3rem }
.bottom-nav .nav-btn .nav-label{ font-size:.65rem; display:none }
.bottom-nav .nav-btn.active{ color:var(--primary-start); }

@media (max-width:700px){
  .bottom-nav{ display:flex }
  /* ensure main content doesn't sit under the nav */
  main{ padding-bottom: 120px }
}
@media (min-width:701px){
  /* Defensive: ensure bottom nav is never visible on wider screens */
  .bottom-nav{ display:none !important; }
}
</style>
</head>
<body>
  <div class="topbar">
    <div class="logo"><button id="btnThemeToggle" class="logo-badge" title="Toggle theme" aria-label="Toggle theme"></button> MOVA</div>
    <!-- Mobile nav toggle (visible only via CSS on small screens) -->
    <button id="btnNavToggle" class="btn" aria-expanded="false" aria-label="Toggle navigation" title="Open navigation">‚ò∞</button>
    <div class="tabbar">
      <button id="tabHome" class="tab active">Home</button>
      <button id="tabPractice" class="tab">Practice</button>
      <button id="tabGrammar" class="tab">Grammar</button>
      <button id="tabLibrary" class="tab">Library</button>
    </div>
    <div class="stats">
      <div class="pill heart"><span>‚ù§Ô∏è</span><span id="tbHearts" style="margin-left:6px">5</span></div>
      <div class="pill xp"><span>‚≠ê</span><span id="tbXP" style="margin-left:6px">0</span></div>
      <div class="pill streak"><span>üî•</span><span id="tbStreak" style="margin-left:6px">0</span></div>
      <button id="btnStartNext" class="btn primary">Start Next Lesson</button>
    </div>
  </div>

  <main>
    <!-- HOME VIEW -->
    <section id="home" class="view active">
      <div class="home-hero">
        <div class="start-card">
          <div class="icon">üöÄ</div>
          <div>
            <div id="startSkillLine"><strong>Start here:</strong> Basics 1</div>
            <div class="muted">Tap <em>Start Next Lesson</em> or click any unlocked skill node below.</div>
          </div>
          <div><button id="heroStart" class="btn primary">Start</button></div>
        </div>
        <div class="card" id="alphabetCard">
          <div class="alph-head">
            <div>
              <div class="title"><strong>Alphabet:</strong> Ukrainian Cyrillic</div>
              <div class="muted">Tap a letter to hear it. Learn in small sets.</div>
            </div>
            <div><button id="btnAlphabetIntro" class="btn primary">About the Alphabet</button></div>
          </div>
        </div>
        <div class="goal">
          <div class="ring" id="dailyRing">0</div>
          <div>
            <div><strong>Daily Goal:</strong> <span id="dailyGoal">30</span> XP</div>
            <div class="mini">Earn XP by completing lessons. Streak continues each day you hit the goal.</div>
          </div>
        </div>
      </div>

      <div id="path" class="path-grid"></div>
    </section>

    <!-- PRACTICE VIEW -->
    <section id="practice" class="view">
      <h2 style="margin:0 0 10px 0">Quick Practice</h2>
      <div class="grid-cards">
        <div class="card">
          <div class="title">üçº Toddler Mode</div>
          <div class="muted">Caregiver phrases, simple commands, routines, toys & body.</div>
          <button id="btnToddler" class="btn blue">Start Toddler Practice</button>
        </div>
        <div class="card">
          <div class="title">üî§ Vocab Drill</div>
          <div class="muted">Core words: greetings, questions, numbers, colors, family, travel.</div>
          <button id="btnVocab" class="btn blue">Start Vocab Drill</button>
        </div>
        <div class="card">
          <div class="title">üéß Audio Drill</div>
          <div class="muted">Listen & choose: Ukrainian ‚Üí English with speech.</div>
          <button id="btnAudio" class="btn blue">Start Audio Drill</button>
        </div>
        <div class="card">
          <div class="title">üìñ EN‚ÜíUK (MC)</div>
          <div class="muted">English prompt with multiple‚Äëchoice Ukrainian answers. No typing.</div>
          <button id="btnReading" class="btn blue">Start EN‚ÜíUK MC</button>
        </div>
        <div class="card">
          <div class="title">üìò Grammar Review</div>
          <div class="muted">Cases, present & past tense, motion vs. location, genitive after negation.</div>
          <button id="btnGrammar" class="btn blue">Start Grammar Review</button>
        </div>
        <div class="card">
          <div class="title">üé≤ Mixed Review</div>
          <div class="muted">A bit of everything from all unlocked skills.</div>
          <button id="btnMixed" class="btn blue">Start Mixed Review</button>
        </div>
      </div>
    </section>

    <!-- GRAMMAR HUB VIEW -->
    <section id="grammar" class="view">
      <h2 style="margin:0">Grammar Hub</h2>
      <p class="muted" style="margin-top:6px">Browse clear, bite‚Äësize explanations. Open during lessons via the <strong>üß† Grammar</strong> button.</p>
      <div class="searchbar">
        <input id="gramSearch" type="search" placeholder="Search grammar (e.g., 'accusative', 'present', 'imperatives')">
        <button id="gramClear" class="btn ghost">Clear</button>
      </div>
      <div id="grammarList" class="grid-cards"></div>
    </section>

    <!-- LIBRARY VIEW -->
    <section id="library" class="view">
      <h2 style="margin:0">Deck Library</h2>
      <div class="searchbar">
        <input id="libSearch" type="search" placeholder="Search decks (e.g., 'animals', 'instrumental', '–¥—ñ–º', 'numbers')‚Ä¶" />
        <button id="libClear" class="btn ghost">Clear</button>
      </div>
      <div id="deckList" class="deck-list"></div>
    </section>

    <!-- LESSON VIEW -->
    <section id="lesson" class="view">
      <div class="lesson-wrap">
        <div class="lesson-top">
          <div id="lessonTitle" class="muted">Skill</div>
          <div class="segments" id="segments"></div>
          <div class="hearts" id="hearts"></div>
        </div>

        <div class="task">
          <div class="prompt">
            <div id="promptLabel"></div>
            <button id="speakBtn" class="speak">üîä</button>
            <span class="mini">/</span>
            <button id="btnOpenGrammar" class="btn ghost">üß† Grammar</button>
          </div>
          <div id="subtitle" class="muted"></div>

          <!-- Media placeholder (for animal pictures etc.) -->
          <div id="mediaArea" class="mediaArea"></div>

          <div id="mcWrap" class="mc-grid"></div>
          <div id="wbWrap" style="display:none">
            <div class="wb-answer" id="wbAnswer"></div>
            <div class="wb-bank" id="wbBank"></div>
          </div>

          <div class="action-bar">
            <div style="flex:1"></div>
            <div class="action-group">
              <button id="btnIDK" class="btn">I don't know</button>
              <button id="btnCheck" class="btn primary" disabled>Check</button>
              <div id="feedback" class="feedback" style="display:none" aria-live="polite"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SUMMARY VIEW -->
    <section id="summary" class="view">
      <div class="summary">
        <div class="xp-burst">+<span id="sumXP">10</span> XP</div>
        <div id="sumMsg">Lesson complete!</div>
        <div class="grid2" style="width:100%">
          <div class="note"><strong>Correct:</strong> <span id="sumCorrect">0</span>/<span id="sumTotal">0</span></div>
          <div class="note"><strong>Hearts left:</strong> <span id="sumHearts">0</span></div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button id="btnNextSkill" class="btn blue">Next Skill</button>
          <button id="btnRedo" class="btn">Redo Lesson</button>
          <button id="btnTips" class="btn ghost">Tips</button>
          <button id="btnToHome" class="btn">Home</button>
        </div>
      </div>
    </section>

    <!-- TIPS VIEW -->
    <section id="tips" class="view">
      <div class="tips">
        <h3 id="tipsTitle">Tips</h3>
        <div id="tipsBody"></div>
        <div style="margin-top:12px"><button id="btnBackFromTips" class="btn">Back</button></div>
      </div>
    </section>
  </main>

  <!-- Alphabet overlay -->
  <div id="alphabetOverlay" class="overlay" aria-hidden="true">
    <div class="modal">
      <div id="alphIntroView">
        <div class="title">Learn the Ukrainian Alphabet</div>
        <p class="muted">Ukrainian uses the Cyrillic script. Some letters map neatly to English sounds while others are new. Tap Start to explore 10 letters at a time with audio.</p>
        <div id="alphabetGrid" class="alph-grid"></div>
        <div class="actions"><button class="btn ghost" id="alphClose">Close</button><button class="btn primary" id="alphStart">Start</button></div>
      </div>
  <div id="alphLessonView" style="display:none">
    <button type="button" class="modal-close-lesson" id="alphCloseLesson" aria-label="Close lesson">‚úï</button>
    <div class="progress" aria-hidden="true"><div id="alphProg"></div></div>
    <div class="title" id="alphLessonTitle" style="text-align:center; margin-top:6px">What sound does this letter make?</div>
  <div id="alphBig" class="alph-bigletter"><div class="ua">–ê –∞</div><div class="phonetic" aria-hidden="true">a</div></div>
  <div class="alph-options" id="alphOptions" role="list"></div>
  <div class="action-bar">
    <div style="flex:1"></div>
    <div class="action-group">
      <div id="alphFeedback" class="feedback" style="display:none" aria-live="polite"></div>
      <div class="actions"><button class="btn" id="alphPlay" aria-label="Play letter sound">üîä</button><button class="btn primary" id="alphCheck">CHECK</button><button class="btn red" id="alphGotIt" style="display:none">Got it</button></div>
    </div>
  </div>
  </div>
  <!-- Alphabet complete modal (centered) -->
  <div id="alphComplete" style="display:none; text-align:center; padding:18px; margin-top:12px">
    <h2>Congratulations!</h2>
    <p class="muted">Great job ‚Äî you completed the alphabet practice.</p>
    <div style="margin-top:12px"><button id="alphCloseComplete" class="btn primary" style="color:#000;">Close</button></div>
  </div>
    </div>
  </div>

  <!-- In-lesson Grammar Side Panel -->
  <aside id="gpanel" class="gpanel" aria-hidden="true">
    <div class="gph">
      <div class="gptitle" id="gptitle">Grammar</div>
      <div class="small">Press <strong>G</strong> to toggle</div>
      <div>
        <button id="gpClose" class="btn">Close</button>
      </div>
    </div>
    <div id="gpBody" class="gpb"></div>
    <div class="gpf">
      <div class="small">Need more? Open the <strong>Grammar Hub</strong>.</div>
      <div>
        <button id="gpPractice" class="btn blue">Practice this</button>
        <button id="gpOpenHub" class="btn ghost">Open Hub</button>
      </div>
    </div>
  </aside>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Mobile bottom navigation (auto-shown on small screens) -->
  <nav id="mobileBottomNav" class="bottom-nav" aria-hidden="true">
    <button class="nav-btn" data-view="#home" aria-label="Home">
      <div class="nav-icon">üè†</div>
      <div class="nav-label">Home</div>
    </button>
    <button class="nav-btn" data-view="#practice" aria-label="Practice">
      <div class="nav-icon">üéß</div>
      <div class="nav-label">Practice</div>
    </button>
    <button class="nav-btn" data-view="#grammar" aria-label="Grammar">
      <div class="nav-icon">üìò</div>
      <div class="nav-label">Grammar</div>
    </button>
    <button class="nav-btn" data-view="#library" aria-label="Library">
      <div class="nav-icon">üìö</div>
      <div class="nav-label">Library</div>
    </button>
  </nav>

  <footer>
    Offline, privacy‚Äëfriendly course. Voices, streak, and hearts are stored in your browser.
  </footer>

<script>
/* ========================
   UTILITIES
   ======================== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function toast(msg){ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1400); }
function todayKey(){ const d = new Date(); return d.toISOString().slice(0,10); }
function normalizeText(s){
  try{
    let t = (s ?? "").toString().trim().toLowerCase().replace(/\\u2019|\\u02bc/g,"'");
    if(typeof t.normalize === "function"){ t = t.normalize("NFC"); }
    return t.replace(/\\s+/g," ");
  }catch(e){ try{ return (s ?? "").toString().toLowerCase(); }catch(_){ return ""; } }
}
function sameText(a,b){ return normalizeText(a) === normalizeText(b); }
function primaryEn(s){ return (s||"").split('/')[0].split('(')[0].trim(); }
function shuffle(a){
  a=[...a];
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    const tmp = a[i]; a[i] = a[j]; a[j] = tmp;
  }
  return a;
}
function tokeniseEN(s){ return primaryEn(s).replace(/[.,!?;:()]/g,'').split(/\\s+/).filter(Boolean); }
function primeTTS(){
  if(!('speechSynthesis' in window)) return;
  function pick(){
    try{
      const vs = speechSynthesis.getVoices() || [];
      if(vs.length){
        window.__VOICE_UK = vs.find(v => (v.lang||"").toLowerCase().startsWith('uk')) || null;
        window.__voicesReady = true;
      }
    }catch(e){}
  }
  try{ pick(); }catch(e){}
  try{ speechSynthesis.onvoiceschanged = pick; }catch(e){}
}
let __voicesReady = false; let __VOICE_UK = null;
function getSpeakText(t){
  try{
    if(!t) return "";
    if(t.speak) return t.speak;
    if(t.kind==='mcg' || t.kind==='wb') return t.prompt || "";
    if(t.direction==='en-uk') return (typeof t.answer === 'string' ? t.answer : (t.prompt||""));
    return t.prompt || t.answer || "";
  }catch(e){ return ""; }
}
function speak(text){
  if(!('speechSynthesis' in window)) return;
  try{ speechSynthesis.cancel(); }catch(e){}
  const u = new SpeechSynthesisUtterance(text);
  const v = __VOICE_UK || (speechSynthesis.getVoices().find(v => (v.lang||"").toLowerCase().startsWith('uk')) || null);
  if(v) u.voice = v;
  u.lang = (v && v.lang) || "uk-UA";
  u.rate = 1;
  try{
    if(!__voicesReady && (speechSynthesis.getVoices()||[]).length===0){ setTimeout(()=>speechSynthesis.speak(u), 180); }
    else{ speechSynthesis.speak(u); }
  }catch(e){}
}
function beep(ok=true){ try{ const ctx = new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='triangle'; o.frequency.value = ok? 1200 : 180; g.gain.value=.0001; o.connect(g); g.connect(ctx.destination); o.start(); const t=ctx.currentTime; g.gain.exponentialRampToValueAtTime(.18, t+.02); g.gain.exponentialRampToValueAtTime(.00001, t+.30); o.stop(t+.31); }catch(e){} }

/* ========================
   ALPHABET MODULE
   ======================== */
const ALPHABET = [
  {u:'–ê', l:'–∞', en:'a', phon:'a', speak:'–∞'},
  {u:'–ë', l:'–±', en:'b', phon:'b', speak:'–±'},
  {u:'–í', l:'–≤', en:'v', phon:'v', speak:'–≤'},
  {u:'–ì', l:'–≥', en:'h', phon:'h', speak:'–≥'},
  {u:'“ê', l:'“ë', en:'g', phon:'g', speak:'“ë'},
  {u:'–î', l:'–¥', en:'d', phon:'d', speak:'–¥'},
  {u:'–ï', l:'–µ', en:'e', phon:'e', speak:'–µ'},
  {u:'–Ñ', l:'—î', en:'ye', phon:'ye', speak:'—î'},
  {u:'–ñ', l:'–∂', en:'zh', phon:'zh', speak:'–∂'},
  {u:'–ó', l:'–∑', en:'z', phon:'z', speak:'–∑'},
  {u:'–ò', l:'–∏', en:'y', phon:"y", speak:'–∏'},
  {u:'–Ü', l:'—ñ', en:'i', phon:'i (ee)', speak:'—ñ'},
  {u:'–á', l:'—ó', en:'yi', phon:'yi', speak:'—ó'},
  {u:'–ô', l:'–π', en:'y', phon:'y', speak:'–π'},
  {u:'–ö', l:'–∫', en:'k', phon:'k', speak:'–∫'},
  {u:'–õ', l:'–ª', en:'l', phon:'l', speak:'–ª'},
  {u:'–ú', l:'–º', en:'m', phon:'m', speak:'–º'},
  {u:'–ù', l:'–Ω', en:'n', phon:'n', speak:'–Ω'},
  {u:'–û', l:'–æ', en:'o', phon:'o', speak:'–æ'},
  {u:'–ü', l:'–ø', en:'p', phon:'p', speak:'–ø'},
  {u:'–†', l:'—Ä', en:'r (rolled)', phon:'r', speak:'—Ä'},
  {u:'–°', l:'—Å', en:'s', phon:'s', speak:'—Å'},
  {u:'–¢', l:'—Ç', en:'t', phon:'t', speak:'—Ç'},
  {u:'–£', l:'—É', en:'u', phon:'u', speak:'—É'},
  {u:'–§', l:'—Ñ', en:'f', phon:'f', speak:'—Ñ'},
  {u:'–•', l:'—Ö', en:'kh (like loch)', phon:'kh', speak:'—Ö'},
  {u:'–¶', l:'—Ü', en:'ts', phon:'ts', speak:'—Ü'},
  {u:'–ß', l:'—á', en:'ch', phon:'ch', speak:'—á'},
  {u:'–®', l:'—à', en:'sh', phon:'sh', speak:'—à'},
  {u:'–©', l:'—â', en:'shch', phon:'shch', speak:'—â'},
  {u:'–¨', l:'—å', en:"soft sign (palatalizes prior consonant)", phon:'soft sign', speak:''},
  {u:'–Æ', l:'—é', en:'yu', phon:'yu', speak:'—é'},
  {u:'–Ø', l:'—è', en:'ya', phon:'ya', speak:'—è'}
];
function buildAlphabetGrid(){
  const root = document.getElementById('alphabetGrid');
  if(!root || root.dataset.built) return;
  root.dataset.built = '1';
  root.innerHTML = ALPHABET.map((x,i)=>`
    <button class="alph-btn" data-idx="${i}" aria-label="${x.u}${x.l} ${x.phon}">
      <div class="letters">${x.u} ${x.l}</div>
      <div class="trans">${x.phon}</div>
    </button>`).join('');
  root.querySelectorAll('.alph-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{ const i = +btn.dataset.idx; playLetter(i); });
  });
}
function playLetter(i){ const L = ALPHABET[i]; if(!L) return; const say = L.speak || L.u; try{ speak(say); }catch(e){ beep(true); } }
function openAlphabetIntro(){ const ov = document.getElementById('alphabetOverlay'); if(!ov) return; ov.classList.add('open'); try{ document.getElementById('alphIntroView').style.display='block'; document.getElementById('alphLessonView').style.display='none'; }catch(e){} }
function closeAlphabet(){ const ov = document.getElementById('alphabetOverlay'); if(ov) ov.classList.remove('open'); }
let ALPH_SESSION = { order:[], idx:0 };
function startAlphabetExercise(){
  const pool = [...ALPHABET];
  ALPH_SESSION.order = shuffle(pool).slice(0,10);
  ALPH_SESSION.idx = 0;
  try{ document.getElementById('alphIntroView').style.display='none'; document.getElementById('alphLessonView').style.display='block'; }catch(e){}
  showAlphStep();
}
function showAlphStep(){
  const L = ALPH_SESSION.order[ALPH_SESSION.idx];
  if(!L){ closeAlphabet(); return; }
  const big = document.getElementById('alphBig'); if(big){ const ua = big.querySelector('.ua'); const ph = big.querySelector('.phonetic'); if(ua) ua.textContent = `${L.u} ${L.l}`; if(ph) ph.textContent = (L.phon || L.en || L.speak || ''); }
  // Auto-play the letter sound when the step is shown (fallback to speak()).
  try{ const toSay = L.speak || L.u; if(toSay) try{ speak(toSay); }catch(e){ beep(true); } }catch(e){}
  const prog = document.getElementById('alphProg'); if(prog){ const pct = Math.round((ALPH_SESSION.idx)/ALPH_SESSION.order.length*100); prog.style.width = pct+"%"; }
}
// ---------- Alphabet lesson: options & checking ----------
function makeDistractors(correctPhon, count=3){
  // pick random phonetics from alphabet excluding the correct one
  const pool = ALPHABET.map(x=>x.phon).filter(p=>p && p!==correctPhon);
  const s = shuffle(pool).slice(0,count);
  return s;
}
function renderAlphOptions(){
  const L = ALPH_SESSION.order[ALPH_SESSION.idx];
  const root = document.getElementById('alphOptions');
  if(!L || !root) return;
  const correct = L.phon || L.en || '';
  const opts = [correct, ...makeDistractors(correct,3)];
  const shuffled = shuffle(opts);
  root.innerHTML = shuffled.map((p,i)=>`<button role="listitem" class="alph-option" data-phon="${escapeHtml(p)}">${p}</button>`).join('');
}
function escapeHtml(s){ return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// selection handling
document.addEventListener('click', (e)=>{
  const t = e.target;
  if(!(t instanceof Element)) return;
  if(t.classList.contains('alph-option')){
    // toggle selection: only one selected at a time
    const root = document.getElementById('alphOptions');
    if(!root) return;
    root.querySelectorAll('.alph-option').forEach(b=> b.classList.remove('selected'));
    t.classList.add('selected');
  }
  if(t.id === 'alphCheck'){
    // evaluate but do NOT auto-advance. Show feedback and require manual continue.
    const root = document.getElementById('alphOptions');
    const sel = root && root.querySelector('.alph-option.selected');
    if(!sel){ toast('Please select an option'); return; }
    const chosen = sel.dataset.phon;
    const L = ALPH_SESSION.order[ALPH_SESSION.idx];
    const correct = (L.phon || L.en || '');
    const checkBtn = document.getElementById('alphCheck');
    const gotBtn = document.getElementById('alphGotIt');
    const fb = document.getElementById('alphFeedback');
    if(chosen === correct){
      // correct ‚Äî show success feedback, highlight correct, replace Check with Continue
      if(fb){ fb.style.display='block'; fb.className='feedback good'; fb.innerHTML = `<strong>Correct!</strong>`; }
      root.querySelectorAll('.alph-option').forEach(b=>{ if(b.dataset.phon===correct) b.classList.add('correct'); b.disabled = true; });
      if(checkBtn) checkBtn.style.display = 'none';
      if(gotBtn) gotBtn.style.display = 'none';
      // create or show Continue button
      let cont = document.getElementById('alphContinue');
      if(!cont){ cont = document.createElement('button'); cont.className='btn primary'; cont.id='alphContinue'; cont.textContent='CONTINUE'; document.querySelector('#alphLessonView .actions').appendChild(cont); }
      else { cont.style.display = 'inline-block'; }
    } else {
      // incorrect ‚Äî show feedback next to buttons, highlight wrong and correct, replace Check with Got it
      if(fb){ fb.style.display='block'; fb.className='feedback bad'; fb.innerHTML = `<strong>Not quite.</strong> <span class="muted">Answer: ${correct}</span>`; }
      root.querySelectorAll('.alph-option').forEach(b=>{ if(b.dataset.phon===correct) b.classList.add('correct'); if(b.dataset.phon===chosen) b.classList.add('wrong'); b.disabled = true; });
      if(checkBtn) checkBtn.style.display = 'none';
      if(gotBtn) gotBtn.style.display = 'inline-block';
      // ensure any continue button is hidden
      const cont = document.getElementById('alphContinue'); if(cont) cont.style.display='none';
    }
  }
  if(t.id === 'alphGotIt'){
    // advance to next letter (same as correct). Reset UI and move forward.
    const got = document.getElementById('alphGotIt'); if(got) got.style.display = 'none';
    const cont = document.getElementById('alphContinue'); if(cont) cont.style.display='none';
    ALPH_SESSION.idx++;
  if(ALPH_SESSION.idx>=ALPH_SESSION.order.length){ showAlphComplete(); }
    else { showAlphStep(); renderAlphOptions(); }
  }
  if(t.id === 'alphContinue'){
    // user clicked continue after correct
    const cont = document.getElementById('alphContinue'); if(cont) cont.style.display='none';
    const got = document.getElementById('alphGotIt'); if(got) got.style.display = 'none';
    ALPH_SESSION.idx++;
  if(ALPH_SESSION.idx>=ALPH_SESSION.order.length){ showAlphComplete(); }
  else { showAlphStep(); renderAlphOptions(); }
  }
});

// ensure options render when step is shown
const origShowAlphStep = showAlphStep;
function showAlphStepWrapper(){
  origShowAlphStep();
  renderAlphOptions();
  // reset feedback and buttons
  const fb = document.getElementById('alphFeedback'); if(fb){ fb.style.display='none'; fb.className='feedback'; fb.innerHTML=''; }
  const got = document.getElementById('alphGotIt'); if(got) got.style.display='none';
  const checkBtn = document.getElementById('alphCheck'); if(checkBtn){ checkBtn.style.display='inline-block'; checkBtn.disabled=false; }
  const cont = document.getElementById('alphContinue'); if(cont) cont.style.display='none';
  // clear option classes and re-enable
  const root = document.getElementById('alphOptions'); if(root){ root.querySelectorAll('.alph-option').forEach(b=>{ b.classList.remove('selected','correct','wrong'); b.disabled = false; }); }
}
// replace references by reassigning the function name used elsewhere
showAlphStep = showAlphStepWrapper;
document.addEventListener('click', (e)=>{
  const t = e.target;
  if(!(t instanceof Element)) return;
  if(t.id==='btnAlphabetIntro'){ openAlphabetIntro(); }
  if(t.id==='alphClose'){ closeAlphabet(); }
  if(t.id==='alphStart'){ startAlphabetExercise(); }
  if(t.id==='alphPlay'){ const L = ALPH_SESSION.order[ALPH_SESSION.idx]; if(L) try{ speak(L.speak || L.u); }catch(e){ beep(true); } }
  if(t.id==='alphNext'){ ALPH_SESSION.idx++; if(ALPH_SESSION.idx>=ALPH_SESSION.order.length){ showAlphComplete(); } else { showAlphStep(); } }
  if(t.id==='alphCloseLesson'){ closeAlphabet(); setView('#home'); }
});
const deckByKey = k => BUILTIN_DECKS[k];

/* ========================
   STATE
   ======================== */
const LS_KEYS = { profile: "ua_duo_profile", progress: "ua_duo_progress" };
const profile = loadProfile(); const progress = loadProgress();
let CURRENT = { skillId: null, hearts: 5, stepsTotal: 10, stepsDone: 0, correct: 0, wrong: 0, tasks: [], idx: 0, modeOverride: null, quickDeckKeys: null, quickName: null, results: [] };
function loadProfile(){
  try{ const p = JSON.parse(localStorage.getItem(LS_KEYS.profile)||"null"); if(p) return p; }catch(e){}
  const p = { xp:0, streak:0, lastDay:null, dailyGoal:30, xpToday:0, dayKey: todayKey(), autoExplain:false };
  localStorage.setItem(LS_KEYS.profile, JSON.stringify(p)); return p;
}
function saveProfile(){ localStorage.setItem(LS_KEYS.profile, JSON.stringify(profile)); }
function refreshDaily(){
  const key = todayKey();
  if(profile.dayKey !== key){
    const prev = new Date(profile.dayKey||key); const today = new Date(key);
    const diff = (today - prev)/(1000*60*60*24);
    if(profile.xpToday >= profile.dailyGoal && diff <= 2){ profile.streak = (profile.streak||0)+1; }
    else if(profile.dayKey){ profile.streak = 0; }
    profile.xpToday = 0; profile.dayKey = key; saveProfile();
  }
}
function loadProgress(){ try{ return JSON.parse(localStorage.getItem(LS_KEYS.progress)||"{}") }catch(e){ return {} } }
function saveProgress(){ localStorage.setItem(LS_KEYS.progress, JSON.stringify(progress)); }
function skillLevel(id){ return progress[id]?.level || 0; }
function addXP(amount){ profile.xp += amount; profile.xpToday += amount; saveProfile(); renderTopbar(); renderHomeHero(); }
function completeSkill(id){ const lvl = skillLevel(id); progress[id] = { level: Math.min(lvl+1, 3) }; saveProgress(); }

// Show alphabet complete modal and award XP/streak
function showAlphComplete(){
  try{
    // award XP and refresh daily/streak
    addXP(10);
    refreshDaily();
    // show centered complete box inside the overlay
    const ac = document.getElementById('alphComplete'); if(ac){ ac.style.display='block'; }
    // hide lesson content
    const lv = document.getElementById('alphLessonView'); if(lv) lv.style.display='none';
    // wire close button
    const c = document.getElementById('alphCloseComplete'); if(c){ c.onclick = ()=>{ const ac=document.getElementById('alphComplete'); if(ac) ac.style.display='none'; closeAlphabet(); } }
  }catch(e){ closeAlphabet(); }
}

/* ========================
   DATA ‚Äî Grammar Topics, Decks, Skills
   ======================== */
const GRAMMAR_TOPICS = {
  translation_basics: {
    title: "Translation Basics (UK‚áÑEN)",
    decks: null,
    html: `
      <div class="tipbox"><strong>No articles in Ukrainian.</strong> Ukrainian has no ‚Äúa/an/the‚Äù. Don't add them when translating to UK; add them freely in English.</div>
      <h4>Word order</h4>
      <p>Default is SVO (<em>–Ø –ª—é–±–ª—é –∫–∞–≤—É</em> = I love coffee), but order is flexible. Focus on meaning words first.</p>
      <h4>Politeness</h4>
      <p><strong>–±—É–¥—å –ª–∞—Å–∫–∞</strong> covers ‚Äúplease‚Äù and ‚Äúyou're welcome‚Äù.</p>
      <h4>Strategy for Word‚ÄëBank</h4>
      <ul><li>Tap <em>content</em> words first (nouns, verbs), then add function words.</li>
      <li>Ignore capitalization and punctuation‚Äîthose don't affect correctness.</li></ul>`
  },
  imperatives: {
    title: "Imperatives (Commands)",
    decks: ["grammar_imperatives","kid_commands"],
    html: `
      <p>Use <strong>2sg imperative</strong> for gentle commands to a child: <em>–°—ñ–¥–∞–π</em> (sit), <em>–ô–¥–∏ —Å—é–¥–∏</em> (come here).
      Immediate single action often uses the perfective or short form: <em>–°—è–¥—å</em> (sit once).</p>
      <table class="tbl"><tr><th>Verb</th><th>2sg</th><th>Example</th></tr>
      <tr><td>–º–∏—Ç–∏ (wash)</td><td>–º–∏–π</td><td><em>–ú–∏–π —Ä—É–∫–∏</em> ‚Äî Wash (your) hands</td></tr>
      <tr><td>–≤—ñ–¥–∫—Ä–∏—Ç–∏ (open)</td><td>–≤—ñ–¥–∫—Ä–∏–π</td><td><em>–í—ñ–¥–∫—Ä–∏–π —Ä–æ—Ç–∏–∫</em> ‚Äî Open your mouth</td></tr></table>
      <div class="tipbox">Polite tone: add <strong>–±—É–¥—å –ª–∞—Å–∫–∞</strong>.</div>`
  },
  possessives: {
    title: "Possessive Pronouns",
    decks: ["grammar_possessives"],
    html: `
      <p>Possessives agree with the <em>gender and number of the noun</em> they modify.</p>
      <table class="tbl">
        <tr><th>English</th><th>Masc</th><th>Fem</th><th>Neut</th><th>Plural</th></tr>
        <tr><td>my</td><td>–º—ñ–π</td><td>–º–æ—è</td><td>–º–æ—î</td><td>–º–æ—ó</td></tr>
        <tr><td>your (sg.)</td><td>—Ç–≤—ñ–π</td><td>—Ç–≤–æ—è</td><td>—Ç–≤–æ—î</td><td>—Ç–≤–æ—ó</td></tr>
        <tr><td>our</td><td>–Ω–∞—à</td><td>–Ω–∞—à–∞</td><td>–Ω–∞—à–µ</td><td>–Ω–∞—à—ñ</td></tr>
      </table>
      <p>Example: <em>—Ç–≤–æ—è –ø–ª—è—à–µ—á–∫–∞</em> (your bottle, fem.).</p>`
  },
  present: {
    title: "Present Tense ‚Äî Key Endings",
    decks: ["grammar_present"],
    html: `
      <table class="tbl">
        <tr><th>Person</th><th>Ending (typical)</th><th>Example (—á–∏—Ç–∞—Ç–∏)</th></tr>
        <tr><td>—è</td><td>-—é / -—É</td><td>—è —á–∏—Ç–∞—é</td></tr>
        <tr><td>—Ç–∏</td><td>-—î—à</td><td>—Ç–∏ —á–∏—Ç–∞—î—à</td></tr>
        <tr><td>–≤—ñ–Ω/–≤–æ–Ω–∞/–≤–æ–Ω–æ</td><td>-—î</td><td>–≤–æ–Ω–∞ —á–∏—Ç–∞—î</td></tr>
        <tr><td>–º–∏</td><td>-—î–º–æ</td><td>–º–∏ —á–∏—Ç–∞—î–º–æ</td></tr>
        <tr><td>–≤–∏</td><td>-—î—Ç–µ</td><td>–≤–∏ —á–∏—Ç–∞—î—Ç–µ</td></tr>
        <tr><td>–≤–æ–Ω–∏</td><td>-—é—Ç—å / -–∞—Ç—å</td><td>–≤–æ–Ω–∏ —á–∏—Ç–∞—é—Ç—å</td></tr>
      </table>
      <div class="tipbox"><strong>–ô—Ç–∏ ‚Üí –π–¥—É/–π–¥–µ—à/–π–¥–µ‚Ä¶</strong> Some verbs are irregular; learn the pattern.</div>`
  },
  past: {
    title: "Past Tense ‚Äî Gender & Number",
    decks: ["grammar_past"],
    html: `
      <p>Past agrees with subject:</p>
      <table class="tbl">
        <tr><th>Masculine</th><th>Feminine</th><th>Neuter</th><th>Plural</th></tr>
        <tr><td>-–≤ (<em>—Ä–æ–±–∏–≤</em>)</td><td>-–ª–∞ (<em>—Ä–æ–±–∏–ª–∞</em>)</td><td>-–ª–æ (<em>—Ä–æ–±–∏–ª–æ</em>)</td><td>-–ª–∏ (<em>—Ä–æ–±–∏–ª–∏</em>)</td></tr>
      </table>`
  },
  cases_overview: {
    title: "Cases ‚Äî Overview",
    decks: ["cases_basic"],
    html: `
      <p>Cases change noun endings to mark function:</p>
      <ul>
        <li><strong>Nominative</strong> ‚Äî subject: <em>–∫—ñ—Ç</em> (the cat).</li>
        <li><strong>Accusative</strong> ‚Äî direct object: <em>–±–∞—á—É –∫–æ—Ç–∞</em> (I see a cat).</li>
        <li><strong>Genitive</strong> ‚Äî of/absence: <em>–Ω–µ–º–∞—î —á–∞—Å—É</em> (no time).</li>
        <li><strong>Dative</strong> ‚Äî to/for: <em>–¥—Ä—É–≥—É</em> (to a friend).</li>
        <li><strong>Instrumental</strong> ‚Äî with/by: <em>–æ–ª—ñ–≤—Ü–µ–º</em> (with a pencil).</li>
        <li><strong>Locative</strong> ‚Äî in/at: <em>—É –ö–∏—î–≤—ñ</em> (in Kyiv).</li>
        <li><strong>Vocative</strong> ‚Äî addressing: <em>–î—Ä—É–∑—ñ!</em> (Friends!).</li>
      </ul>`
  },
  instrumental: {
    title: "Instrumental Case (—á–∏–º?)",
    decks: ["cases_instrumental"],
    html: `
      <p>Use with tools, companionship, professions after <em>–±—É—Ç–∏/—Å—Ç–∞—Ç–∏</em>, and after preposition <strong>–∑</strong>:</p>
      <ul><li><em>–ø–∏—Å–∞—Ç–∏ –æ–ª—ñ–≤—Ü–µ–º</em> ‚Äî write with a pencil</li>
      <li><em>–∑ –¥—Ä—É–≥–æ–º</em> ‚Äî with a friend</li>
      <li><em>–≤—ñ–Ω —Å—Ç–∞–≤ —É—á–∏—Ç–µ–ª–µ–º</em> ‚Äî he became a teacher</li></ul>`
  },
  locative: {
    title: "Locative Case (–¥–µ?)",
    decks: ["cases_locative"],
    html: `<p>Use for location after <strong>–≤/—É</strong>, <strong>–Ω–∞</strong>:</p>
      <ul><li><em>—É —à–∫–æ–ª—ñ</em> (at school)</li><li><em>–Ω–∞ —Ä–æ–±–æ—Ç—ñ</em> (at work)</li><li><em>—É –ö–∏—î–≤—ñ</em> (in Kyiv)</li></ul>`
  },
  prepositions_motion: {
    title: "Prepositions: Motion vs. Location",
    decks: ["grammar_prepositions"],
    html: `<p><strong>Location</strong> ‚Üí Locative: <em>—É –∫–æ—Ä–æ–±—Ü—ñ</em>, <em>–Ω–∞ —Å—Ç–æ–ª—ñ</em>.<br>
           <strong>Motion (into/onto)</strong> ‚Üí Accusative: <em>–≤ –∫–æ—Ä–æ–±–∫—É</em>, <em>–Ω–∞ —Å—Ç—ñ–ª</em>.<br>
           <strong>–¥–æ</strong> + Genitive for ‚Äúto (a place)‚Äù: <em>–¥–æ –ø–∞—Ä–∫—É</em>.</p>`
  },
  genitive_negation: {
    title: "Genitive after Negation",
    decks: ["grammar_genitive_neg"],
    html: `<p>After <strong>–Ω–µ–º–∞—î</strong> / <strong>–Ω–µ –±—É–ª–æ</strong>: use Genitive.</p>
           <ul><li><em>–Ω–µ–º–∞—î –≤–æ–¥–∏</em> ‚Äî there is no water</li><li><em>–Ω–µ –±—É–ª–æ –ª—é–¥–µ–π</em> ‚Äî there were no people</li></ul>`
  },
  nominative: { title:"Nominative ‚Äî Who/What? (–•—Ç–æ? –©–æ?)", decks:null, html:`
    <p><strong>Use:</strong> subject & naming.</p>
    <ul><li><em>–ö–∏—ó–≤ ‚Äî —Å—Ç–æ–ª–∏—Ü—è.</em></li><li><em>–í—ñ–Ω –ª—ñ–∫–∞—Ä.</em></li></ul>
    <div class="tipbox">Present copula often omitted.</div>` },
  genitive: { title:"Genitive ‚Äî Of/From/Without", decks:null, html:`
    <p>Possession, quantity, from/near, after negation.</p>` },
  dative: { title:"Dative ‚Äî To/For", decks:null, html:`
    <p>Indirect object; experiencer: <em>–º–µ–Ω—ñ —Ö–æ–ª–æ–¥–Ω–æ</em>.</p>` },
  accusative: { title:"Accusative ‚Äî Object/Motion", decks: ["cases_accusative"], html:`
    <p>Direct object; into/onto with motion.</p>` },
  vocative: { title:"Vocative ‚Äî Addressing", decks:null, html:`<p>–ú–∞–º–æ! –ê–Ω–¥—Ä—ñ—é!</p>` },
  future: { title:"Future ‚Äî Simple & Compound", decks:["grammar_future"], html:`<p>–±—É–¥—É + INF; perfective simple future.</p>` },
  aspect: { title:"Aspect ‚Äî Perf vs. Imperf", decks:["grammar_aspect"], html:`<p>Process vs. completed whole.</p>` },
  conjugation_breakdown: { title:"Conjugation ‚Äî Patterns", decks:["grammar_conjugation"], html:`<p>1st vs 2nd endings.</p>` },
  agreement: { title:"Agreement", decks:["grammar_agreement"], html:`<p>Adj/pronouns & past agree with noun/speaker.</p>` },
  gender_basics: { title:"Gender of Nouns", decks:["grammar_gender"], html:`<p>m/f/n typical endings.</p>` },
  questions_answers: { title:"Questions & Answers", decks:["grammar_questions"], html:`<p>—Ö—Ç–æ, —â–æ, –¥–µ, –∫–æ–ª–∏, —á–∏‚Ä¶</p>` },
  negation_full: { title:"Negation", decks:["grammar_negation"], html:`<p>–Ω–µ + verb; –Ω—ñ–∫–æ–≥–æ/–Ω—ñ—á–æ–≥–æ; –Ω–µ–º–∞—î + Gen.</p>` },
  reflexive_sya: { title:"Reflexive ‚Äë—Å—è/‚Äë—Å—å", decks:["grammar_reflexive"], html:`<p>–º–∏—é—Å—è, –∑—É—Å—Ç—Ä—ñ—á–∞—î–º–æ—Å—è, –Ω–∞–∑–∏–≤–∞—Ç–∏—Å—è.</p>` },
  motion_verbs: { title:"Motion ‚Äî –π—Ç–∏/—Ö–æ–¥–∏—Ç–∏, —ó—Ö–∞—Ç–∏/—ó–∑–¥–∏—Ç–∏", decks:["grammar_motion"], html:`<p>Directional vs habitual.</p>` },
  word_order: { title:"Word Order & Focus", decks:["grammar_word_order"], html:`<p>Neutral SVO; focus late.</p>` },
  copula_je: { title:"Copula ‚Äî —î / —Ü–µ / ‚Äî", decks:["grammar_copula"], html:`<p>—î for existence; —Ü–µ for ID; ‚Äî in present.</p>` },
  pronouns_cases: { title:"Personal Pronouns by Case", decks:["grammar_pronouns_cases"], html:`<p>Forms table.</p>` },
  comparison: { title:"Comparatives & Superlatives", decks:["grammar_comparison"], html:`<p>-—ñ—à-, –Ω–∞–π-; –Ω—ñ–∂.</p>` }
};

const BUILTIN_DECKS = {};
Object.assign(BUILTIN_DECKS, {
  greetings: { name: "Greetings", type: "vocab", items: [
    {uk:"–ü—Ä–∏–≤—ñ—Ç", en:"Hi"}, {uk:"–î–æ–±—Ä–æ–≥–æ —Ä–∞–Ω–∫—É", en:"Good morning"}, {uk:"–î–æ–±—Ä–∏–π –¥–µ–Ω—å", en:"Good afternoon / Hello"},
    {uk:"–î–æ–±—Ä–∏–π –≤–µ—á—ñ—Ä", en:"Good evening"}, {uk:"–î–æ –ø–æ–±–∞—á–µ–Ω–Ω—è", en:"Goodbye"}, {uk:"–ë—É–≤–∞–π", en:"Bye (informal)"},
    {uk:"–ë—É–¥—å –ª–∞—Å–∫–∞", en:"Please / You're welcome"}, {uk:"–î—è–∫—É—é", en:"Thank you"}, {uk:"–ü–µ—Ä–µ–ø—Ä–æ—à—É—é", en:"Excuse me / Sorry"},
    {uk:"–Ø–∫ —Å–ø—Ä–∞–≤–∏?", en:"How are you?"}, {uk:"–ú–µ–Ω–µ –∑–≤–∞—Ç–∏‚Ä¶", en:"My name is‚Ä¶"}, {uk:"–ü—Ä–∏—î–º–Ω–æ –ø–æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è", en:"Nice to meet you"}, {uk:"–î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ", en:"See you"}
  ]},
  basics_core: { name: "Basics ‚Äî Core phrases", type: "vocab", items: [
    {uk:"–¢–∞–∫", en:"Yes"}, {uk:"–ù—ñ", en:"No"}, {uk:"–î–æ–±—Ä–µ", en:"Good / OK"}, {uk:"–ü–æ–≥–∞–Ω–æ", en:"Bad"}, {uk:"–ß—É–¥–æ–≤–æ", en:"Great"},
    {uk:"–ú–æ–∂–Ω–∞?", en:"May I? / Is it allowed?"}, {uk:"–ù–µ –º–æ–∂–Ω–∞", en:"Not allowed / Don't"}, {uk:"–î–µ‚Ä¶?", en:"Where is‚Ä¶?"}, {uk:"–°–∫—ñ–ª—å–∫–∏ —Ü–µ –∫–æ—à—Ç—É—î?", en:"How much is this?"},
    {uk:"–Ø –Ω–µ —Ä–æ–∑—É–º—ñ—é", en:"I don't understand"}, {uk:"–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å, –±—É–¥—å –ª–∞—Å–∫–∞", en:"Repeat, please"}, {uk:"–ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ, –±—É–¥—å –ª–∞—Å–∫–∞", en:"Slower, please"},
    {uk:"–©–æ —Ü–µ?", en:"What is this?"}, {uk:"–ö–æ–ª–∏‚Ä¶?", en:"When‚Ä¶?"}, {uk:"–ß–æ–º—É‚Ä¶?", en:"Why‚Ä¶?"}, {uk:"–Ø–∫‚Ä¶?", en:"How‚Ä¶?"}, {uk:"–•—Ç–æ‚Ä¶?", en:"Who‚Ä¶?"}, {uk:"–Ø –∑ –£–∫—Ä–∞—ó–Ω–∏", en:"I am from Ukraine"}
  ]},
  basics_pronouns_q: { name:"Basics ‚Äî Pronouns & Question words", type:"vocab", items: [
    {uk:"—è", en:"I"}, {uk:"—Ç–∏", en:"you (singular)"}, {uk:"–≤—ñ–Ω", en:"he"}, {uk:"–≤–æ–Ω–∞", en:"she"}, {uk:"–≤–æ–Ω–æ", en:"it"},
    {uk:"–º–∏", en:"we"}, {uk:"–≤–∏", en:"you (plural/formal)"}, {uk:"–≤–æ–Ω–∏", en:"they"}, {uk:"—Ü–µ–π / —Ü—è / —Ü–µ / —Ü—ñ", en:"this (m/f/n/pl)"},
    {uk:"—Ç–æ–π / —Ç–∞ / —Ç–µ / —Ç—ñ", en:"that (m/f/n/pl)"}, {uk:"—Ö—Ç–æ", en:"who"}, {uk:"—â–æ", en:"what"}, {uk:"–¥–µ", en:"where"}, {uk:"–∫–æ–ª–∏", en:"when"},
    {uk:"—á–æ–º—É", en:"why"}, {uk:"—è–∫", en:"how"}, {uk:"—Å–∫—ñ–ª—å–∫–∏", en:"how many/how much"}, {uk:"—è–∫–∏–π / —è–∫–∞ / —è–∫–µ / —è–∫—ñ", en:"which; what kind (m/f/n/pl)"}
  ]},
  basics_adjectives: { name:"Basics ‚Äî Common adjectives", type:"vocab", items: [
    {uk:"–≤–µ–ª–∏–∫–∏–π / –º–∞–ª–µ–Ω—å–∫–∏–π", en:"big / small"}, {uk:"–≥–∞—Ä—è—á–∏–π / —Ö–æ–ª–æ–¥–Ω–∏–π", en:"hot / cold"}, {uk:"—á–∏—Å—Ç–∏–π / –±—Ä—É–¥–Ω–∏–π", en:"clean / dirty"},
    {uk:"–º–æ–∫—Ä–∏–π / —Å—É—Ö–∏–π", en:"wet / dry"}, {uk:"–Ω–æ–≤–∏–π / —Å—Ç–∞—Ä–∏–π", en:"new / old"}, {uk:"–≥–∞—Ä–Ω–∏–π / –ø–æ–≥–∞–Ω–∏–π", en:"good / bad"},
    {uk:"—â–∞—Å–ª–∏–≤–∏–π / —Å—É–º–Ω–∏–π", en:"happy / sad"}, {uk:"–≤—Ç–æ–º–ª–µ–Ω–∏–π", en:"tired"}, {uk:"–≥–æ–ª–æ–¥–Ω–∏–π", en:"hungry"}, {uk:"—Å–ø—Ä–∞–≥–ª–∏–π", en:"thirsty"}, {uk:"—à–≤–∏–¥–∫–∏–π / –ø–æ–≤—ñ–ª—å–Ω–∏–π", en:"fast / slow"},
    {uk:"–±–µ–∑–ø–µ—á–Ω–∏–π / –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π", en:"safe / dangerous"}
  ]},
  alphabet_ua: { name:"Alphabet ‚Äî Ukrainian letters", type:"vocab", items: [
    {uk:"–ê –∞", en:"A (ah)"}, {uk:"–ë –±", en:"B (be)"}, {uk:"–í –≤", en:"V (ve)"}, {uk:"–ì –≥", en:"H (he)"}, {uk:"“ê “ë", en:"G (ge)"},
    {uk:"–î –¥", en:"D (de)"}, {uk:"–ï –µ", en:"E (e)"}, {uk:"–Ñ —î", en:"Ye (ye)"}, {uk:"–ñ –∂", en:"Zh (zhe)"}, {uk:"–ó –∑", en:"Z (ze)"},
    {uk:"–ò –∏", en:"Y (y)"}, {uk:"–Ü —ñ", en:"I (i)"}, {uk:"–á —ó", en:"Yi (yi)"}, {uk:"–ô –π", en:"Y (yot)"}, {uk:"–ö –∫", en:"K (ka)"},
    {uk:"–õ –ª", en:"L (el)"}, {uk:"–ú –º", en:"M (em)"}, {uk:"–ù –Ω", en:"N (en)"}, {uk:"–û –æ", en:"O (o)"}, {uk:"–ü –ø", en:"P (pe)"},
    {uk:"–† —Ä", en:"R (er)"}, {uk:"–° —Å", en:"S (es)"}, {uk:"–¢ —Ç", en:"T (te)"}, {uk:"–£ —É", en:"U (u)"}, {uk:"–§ —Ñ", en:"F (ef)"},
    {uk:"–• —Ö", en:"Kh (kha)"}, {uk:"–¶ —Ü", en:"Ts (tse)"}, {uk:"–ß —á", en:"Ch (che)"}, {uk:"–® —à", en:"Sh (sha)"}, {uk:"–© —â", en:"Shch (shcha)"},
    {uk:"–¨ —å", en:"Soft sign"}, {uk:"–Æ —é", en:"Yu (yu)"}, {uk:"–Ø —è", en:"Ya (ya)"}
  ]},
  phrases: { name: "Everyday phrases", type: "vocab", items: [
    {uk:"–Ø –Ω–µ —Ä–æ–∑—É–º—ñ—é", en:"I don't understand"}, {uk:"–í–∏ –≥–æ–≤–æ—Ä–∏—Ç–µ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é?", en:"Do you speak English?"},
    {uk:"–î–µ —Ç—É–∞–ª–µ—Ç?", en:"Where is the bathroom?"}, {uk:"–°–∫—ñ–ª—å–∫–∏ —Ü–µ –∫–æ—à—Ç—É—î?", en:"How much is this?"},
    {uk:"–î–æ–ø–æ–º–æ–∂—ñ—Ç—å, –±—É–¥—å –ª–∞—Å–∫–∞", en:"Help, please"}, {uk:"–ú–µ–Ω—ñ –ø–æ–¥–æ–±–∞—î—Ç—å—Å—è", en:"I like it"},
    {uk:"–ú–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ‚Ä¶", en:"I need‚Ä¶"}, {uk:"–ó–≤—ñ–¥–∫–∏ –≤–∏?", en:"Where are you from?"},
    {uk:"–°–º–∞—á–Ω–æ–≥–æ!", en:"Bon app√©tit!"}, {uk:"–£–¥–∞—á—ñ!", en:"Good luck!"}
  ]},
  numbers: { name: "Numbers 1‚Äì10", type:"vocab", items: [
    {uk:"–æ–¥–∏–Ω", en:"one"}, {uk:"–¥–≤–∞", en:"two"}, {uk:"—Ç—Ä–∏", en:"three"}, {uk:"—á–æ—Ç–∏—Ä–∏", en:"four"}, {uk:"–ø'—è—Ç—å", en:"five"},
    {uk:"—à—ñ—Å—Ç—å", en:"six"}, {uk:"—Å—ñ–º", en:"seven"}, {uk:"–≤—ñ—Å—ñ–º", en:"eight"}, {uk:"–¥–µ–≤'—è—Ç—å", en:"nine"}, {uk:"–¥–µ—Å—è—Ç—å", en:"ten"}
  ]},
  numbers_11_20: { name:"Numbers 11‚Äì20", type:"vocab", items: [
    {uk:"–æ–¥–∏–Ω–∞–¥—Ü—è—Ç—å", en:"eleven"}, {uk:"–¥–≤–∞–Ω–∞–¥—Ü—è—Ç—å", en:"twelve"}, {uk:"—Ç—Ä–∏–Ω–∞–¥—Ü—è—Ç—å", en:"thirteen"}, {uk:"—á–æ—Ç–∏—Ä–Ω–∞–¥—Ü—è—Ç—å", en:"fourteen"},
    {uk:"–ø'—è—Ç–Ω–∞–¥—Ü—è—Ç—å", en:"fifteen"}, {uk:"—à—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç—å", en:"sixteen"}, {uk:"—Å—ñ–º–Ω–∞–¥—Ü—è—Ç—å", en:"seventeen"}, {uk:"–≤—ñ—Å—ñ–º–Ω–∞–¥—Ü—è—Ç—å", en:"eighteen"},
    {uk:"–¥–µ–≤'—è—Ç–Ω–∞–¥—Ü—è—Ç—å", en:"nineteen"}, {uk:"–¥–≤–∞–¥—Ü—è—Ç—å", en:"twenty"}
  ]},
  colors: { name:"Colors", type:"vocab", items: [
    {uk:"—á–µ—Ä–≤–æ–Ω–∏–π", en:"red"}, {uk:"—Å–∏–Ω—ñ–π", en:"blue"}, {uk:"–∑–µ–ª–µ–Ω–∏–π", en:"green"}, {uk:"–∂–æ–≤—Ç–∏–π", en:"yellow"},
    {uk:"—á–æ—Ä–Ω–∏–π", en:"black"}, {uk:"–±—ñ–ª–∏–π", en:"white"}, {uk:"—Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–π", en:"purple"}, {uk:"–ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π", en:"orange"},
    {uk:"–∫–æ—Ä–∏—á–Ω–µ–≤–∏–π", en:"brown"}, {uk:"—Å—ñ—Ä–∏–π", en:"gray"}
  ]},
  shapes: { name:"Shapes", type:"vocab", items: [
    {uk:"–∫–æ–ª–æ", en:"circle"},{uk:"–∫–≤–∞–¥—Ä–∞—Ç", en:"square"},{uk:"—Ç—Ä–∏–∫—É—Ç–Ω–∏–∫", en:"triangle"},
    {uk:"–ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫", en:"rectangle"},{uk:"–∑—ñ—Ä–∫–∞", en:"star"},{uk:"—Å–µ—Ä—Ü–µ", en:"heart"}
  ]},
  weather: { name:"Weather & Nature", type:"vocab", items: [
    {uk:"—Å–æ–Ω—è—á–Ω–æ", en:"sunny"}, {uk:"—Ö–º–∞—Ä–Ω–æ", en:"cloudy"}, {uk:"–¥–æ—â", en:"rain"}, {uk:"—Å–Ω—ñ–≥", en:"snow"},
    {uk:"–≤—ñ—Ç–µ—Ä", en:"wind"}, {uk:"—Ç–µ–ø–ª–æ", en:"warm"}, {uk:"—Ö–æ–ª–æ–¥–Ω–æ", en:"cold"}, {uk:"–∂–∞—Ä–∫–æ", en:"hot"}, {uk:"—Å–ª–∏–∑—å–∫–æ", en:"slippery"},
    {uk:"–≥—Ä—ñ–º —ñ –±–ª–∏—Å–∫–∞–≤–∫–∞", en:"thunder and lightning"}
  ]},
  seasons_months: { name:"Seasons & Months", type:"vocab", items: [
    {uk:"–≤–µ—Å–Ω–∞", en:"spring"},{uk:"–ª—ñ—Ç–æ", en:"summer"},{uk:"–æ—Å—ñ–Ω—å", en:"autumn"},{uk:"–∑–∏–º–∞", en:"winter"},
    {uk:"—Å—ñ—á–µ–Ω—å", en:"January"},{uk:"–ª—é—Ç–∏–π", en:"February"},{uk:"–±–µ—Ä–µ–∑–µ–Ω—å", en:"March"},{uk:"–∫–≤—ñ—Ç–µ–Ω—å", en:"April"},
    {uk:"—Ç—Ä–∞–≤–µ–Ω—å", en:"May"},{uk:"—á–µ—Ä–≤–µ–Ω—å", en:"June"},{uk:"–ª–∏–ø–µ–Ω—å", en:"July"},{uk:"—Å–µ—Ä–ø–µ–Ω—å", en:"August"},
    {uk:"–≤–µ—Ä–µ—Å–µ–Ω—å", en:"September"},{uk:"–∂–æ–≤—Ç–µ–Ω—å", en:"October"},{uk:"–ª–∏—Å—Ç–æ–ø–∞–¥", en:"November"},{uk:"–≥—Ä—É–¥–µ–Ω—å", en:"December"}
  ]},
  time_day: { name:"Time of day & schedule", type:"vocab", items: [
    {uk:"—Ä–∞–Ω–æ–∫", en:"morning"}, {uk:"–¥–µ–Ω—å", en:"day/afternoon"}, {uk:"–≤–µ—á—ñ—Ä", en:"evening"}, {uk:"–Ω—ñ—á", en:"night"},
    {uk:"–∑–∞—Ä–∞–∑", en:"now"}, {uk:"–ø—ñ–∑–Ω—ñ—à–µ", en:"later"}, {uk:"–∑–∞–≤—Ç—Ä–∞", en:"tomorrow"}, {uk:"–≤—á–æ—Ä–∞", en:"yesterday"},
    {uk:"–Ω–µ–≥–∞–π–Ω–æ", en:"right now"}, {uk:"—Å–∫–æ—Ä–æ", en:"soon"}, {uk:"–ø–æ—Ç—ñ–º", en:"afterwards"}
  ]},
  rooms_household: { name:"Rooms & household", type:"vocab", items: [
    {uk:"–∫—É—Ö–Ω—è", en:"kitchen"},{uk:"–≤–∞–Ω–Ω–∞", en:"bathroom"},{uk:"—Å–ø–∞–ª—å–Ω—è", en:"bedroom"},
    {uk:"–≤—ñ—Ç–∞–ª—å–Ω—è", en:"living room"},{uk:"–ª—ñ–∂–∫–æ", en:"bed"},{uk:"–¥–∏—Ç—è—á–µ –ª—ñ–∂–µ—á–∫–æ", en:"crib"},
    {uk:"—Å—Ç—ñ–ª", en:"table"},{uk:"—Å—Ç—ñ–ª–µ—Ü—å", en:"chair"},{uk:"—à–∞—Ñ–∞", en:"wardrobe"},
    {uk:"–≤—ñ–∑–æ—á–æ–∫", en:"stroller"},{uk:"–∫–æ–ª—è—Å–∫–∞", en:"pram"}
  ]},
  clothes_kid: { name:"Clothes (kid)", type:"vocab", items: [
    {uk:"–±–æ–¥—ñ", en:"onesie"}, {uk:"—Å–æ—Ä–æ—á–µ—á–∫–∞", en:"shirt (little)"},{uk:"—à—Ç–∞–Ω—Ü—ñ", en:"pants (little)"},
    {uk:"—à–∫–∞—Ä–ø–µ—Ç–∫–∏", en:"socks"},{uk:"—á–µ—Ä–µ–≤–∏–∫–∏", en:"shoes"},{uk:"–∫—Ä–æ—Å—ñ–≤–∫–∏", en:"sneakers"},
    {uk:"—à–∞–ø–∫–∞", en:"hat"},{uk:"–∫—É—Ä—Ç–∫–∞", en:"jacket"},{uk:"—Ä—É–∫–∞–≤–∏—Ü—ñ", en:"mittens"},
    {uk:"–ø–µ–ª—é—à–∫–∞", en:"swaddle"},{uk:"–ø—ñ–¥–≥—É–∑–æ–∫/–ø–∞–º–ø–µ—Ä—Å", en:"diaper"}
  ]},
  toys_objects: { name:"Toys & objects", type:"vocab", items: [
    {uk:"—ñ–≥—Ä–∞—à–∫–∞", en:"toy"},{uk:"–º'—è—á", en:"ball"},{uk:"–ª—è–ª—å–∫–∞", en:"doll"},
    {uk:"–º–∞—à–∏–Ω–∫–∞", en:"toy car"},{uk:"–∫–Ω–∏–∂–∫–∞", en:"book"},{uk:"–∫—É–±–∏–∫–∏", en:"blocks"},
    {uk:"–ø—ñ—Ä–∞–º—ñ–¥–∫–∞", en:"stacking toy"},{uk:"–ø–∞–∑–ª", en:"puzzle"},{uk:"–æ–ª—ñ–≤–µ—Ü—å", en:"pencil"},
    {uk:"—Ñ–ª–æ–º–∞—Å—Ç–µ—Ä", en:"marker"},{uk:"–ø–∞–ø—ñ—Ä", en:"paper"},{uk:"–ø–ª—è—à–µ—á–∫–∞", en:"bottle"},
    {uk:"–ø—É—Å—Ç—É—à–∫–∞ / —Å–æ—Å–∫–∞", en:"pacifier"},{uk:"–∫–æ–≤–¥—Ä–∞", en:"blanket"},{uk:"–ø–æ–¥—É—à–∫–∞", en:"pillow"}
  ]},
  travel: { name:"Travel basics", type:"vocab", items: [
    {uk:"–∑–∞–ª—ñ–∑–Ω–∏—á–Ω–∏–π –≤–æ–∫–∑–∞–ª", en:"train station"}, {uk:"–∞–µ—Ä–æ–ø–æ—Ä—Ç", en:"airport"}, {uk:"–∫–≤–∏—Ç–æ–∫", en:"ticket"},
    {uk:"–ø–∞—Å–ø–æ—Ä—Ç", en:"passport"}, {uk:"–≥–æ—Ç–µ–ª—å", en:"hotel"}, {uk:"–±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è", en:"reservation"},
    {uk:"–≤–∏—Ö—ñ–¥", en:"exit"}, {uk:"–≤—Ö—ñ–¥", en:"entrance"}, {uk:"–ø—Ä–∞–≤–æ—Ä—É—á", en:"to the right"}, {uk:"–ª—ñ–≤–æ—Ä—É—á", en:"to the left"},
    {uk:"–ø—Ä—è–º–æ", en:"straight ahead"}, {uk:"–¥–µ –∑—É–ø–∏–Ω–∫–∞ –∞–≤—Ç–æ–±—É—Å–∞?", en:"where is the bus stop?"}, {uk:"—Å–∫—ñ–ª—å–∫–∏ —á–∞—Å—É?", en:"what time is it?"},
    {uk:"—á–∏ –º–æ–∂–Ω–∞ –∫–∞—Ä—Ç–∫–æ—é?", en:"can I pay by card?"}, {uk:"—è –∑–∞–≥—É–±–∏–≤—Å—è / –∑–∞–≥—É–±–∏–ª–∞—Å—è", en:"I am lost (m/f)"}
  ]},
  family: { name:"Family & people", type:"vocab", items: [
    {uk:"—Ä–æ–¥–∏–Ω–∞", en:"family"}, {uk:"–±–∞—Ç—å–∫–æ / —Ç–∞—Ç–æ", en:"father / dad"}, {uk:"–º–∞—Ç–∏ / –º–∞–º–∞", en:"mother / mom"},
    {uk:"—Å–∏–Ω", en:"son"}, {uk:"–¥–æ—á–∫–∞", en:"daughter"}, {uk:"—á–æ–ª–æ–≤—ñ–∫", en:"husband"}, {uk:"–¥—Ä—É–∂–∏–Ω–∞", en:"wife"},
    {uk:"–±—Ä–∞—Ç", en:"brother"}, {uk:"—Å–µ—Å—Ç—Ä–∞", en:"sister"}, {uk:"–¥—ñ–¥—É—Å—å", en:"grandfather"}, {uk:"–±–∞–±—É—Å—è", en:"grandmother"},
    {uk:"–¥—Ä—É–∑—ñ", en:"friends"}, {uk:"–Ω—è–Ω—è", en:"nanny"}
  ]},
  verbs_basic: { name:"Common verbs (inf.)", type:"vocab", items: [
    {uk:"—ó—Å—Ç–∏", en:"to eat"}, {uk:"–ø–∏—Ç–∏", en:"to drink"}, {uk:"–π—Ç–∏", en:"to go (on foot)"}, {uk:"—ó—Ö–∞—Ç–∏", en:"to go (by vehicle)"},
    {uk:"–±–∞—á–∏—Ç–∏", en:"to see"}, {uk:"—á—É—Ç–∏", en:"to hear"}, {uk:"—á–∏—Ç–∞—Ç–∏", en:"to read"}, {uk:"–ø–∏—Å–∞—Ç–∏", en:"to write"}, {uk:"–≥–æ–≤–æ—Ä–∏—Ç–∏", en:"to speak"},
    {uk:"—Ä–æ–∑—É–º—ñ—Ç–∏", en:"to understand"}, {uk:"–ø—Ä–∞—Ü—é–≤–∞—Ç–∏", en:"to work"}, {uk:"–≤—á–∏—Ç–∏—Å—è", en:"to study/learn"}, {uk:"—Å–ø–∞—Ç–∏", en:"to sleep"}, {uk:"–≥—Ä–∞—Ç–∏—Å—è", en:"to play"}
  ]},
  days: { name:"Days of the week", type:"vocab", items: [
    {uk:"–ø–æ–Ω–µ–¥—ñ–ª–æ–∫", en:"Monday"}, {uk:"–≤—ñ–≤—Ç–æ—Ä–æ–∫", en:"Tuesday"}, {uk:"—Å–µ—Ä–µ–¥–∞", en:"Wednesday"},
    {uk:"—á–µ—Ç–≤–µ—Ä", en:"Thursday"}, {uk:"–ø'—è—Ç–Ω–∏—Ü—è", en:"Friday"}, {uk:"—Å—É–±–æ—Ç–∞", en:"Saturday"}, {uk:"–Ω–µ–¥—ñ–ª—è", en:"Sunday"}
  ]},
  body_kids: { name:"Body parts (kid)", type:"vocab", items: [
    {uk:"–≥–æ–ª–æ–≤–∞", en:"head"}, {uk:"–æ—á—ñ", en:"eyes"}, {uk:"–≤—É—Ö–∞", en:"ears"}, {uk:"–Ω–æ—Å–∏–∫", en:"little nose"},
    {uk:"—Ä–æ—Ç–∏–∫", en:"little mouth"}, {uk:"—Ä—É—á–∫–∞", en:"little hand/arm"}, {uk:"–Ω—ñ–∂–∫–∞", en:"little leg/foot"},
    {uk:"–∂–∏–≤–æ—Ç–∏–∫", en:"tummy"}, {uk:"—Å–ø–∏–Ω–∫–∞", en:"back"}, {uk:"–∫–æ–ª—ñ–Ω–∞", en:"knees"}, {uk:"–ø–∞–ª—å—á–∏–∫–∏", en:"little fingers/toes"}
  ]},
  kid_phrases_caregiver: { name:"Caregiver phrases (0‚Äì2y)", type:"vocab", items: [
    {uk:"–ú–æ–ª–æ–¥–µ—Ü—å!", en:"Well done!"},{uk:"–í—Å–µ –≥–∞—Ä–∞–∑–¥", en:"It's okay"},{uk:"–ù–µ –ø–ª–∞—á", en:"Don't cry"},
    {uk:"–Ø –ø–æ—Ä—É—á", en:"I'm right here"},{uk:"–û–±—ñ–π–º–∏", en:"Hug"},{uk:"–î–∞–π –ø–æ—Ü—ñ–ª—É–Ω–æ–∫", en:"Give me a kiss"},
    {uk:"–ë–æ–ª—è—á–µ?", en:"Does it hurt?"},{uk:"–•–æ—á–µ—à —â–µ?", en:"Do you want more?"},
    {uk:"–î–∞–≤–∞–π —Ä–∞–∑–æ–º", en:"Let's do it together"},{uk:"–ü–æ—á–µ–∫–∞–π —Ö–≤–∏–ª–∏–Ω–∫—É", en:"Wait a moment"},
    {uk:"–¢–∏—Ö—ñ—à–µ", en:"Quieter"},{uk:"–°—Ç–æ–ø", en:"Stop"},{uk:"–û–±–µ—Ä–µ–∂–Ω–æ!", en:"Careful!"},
    {uk:"–ù–µ –º–æ–∂–Ω–∞", en:"Don't / It's not allowed"},{uk:"–î–µ –Ω–æ—Å–∏–∫?", en:"Where is (your) nose?"},
    {uk:"–î–µ –≤—É—à–∫–∞?", en:"Where are (your) ears?"},{uk:"–î–µ –æ—á–µ–Ω—è—Ç–∞?", en:"Where are (your) little eyes?"},
    {uk:"–î–∞–π —Ä—É–∫—É", en:"Give me your hand"}
  ]},
  kid_commands: { name:"Commands for toddlers", type:"vocab", items: [
    {uk:"–°—ñ–¥–∞–π", en:"Sit down"},{uk:"–í—Å—Ç–∞–≤–∞–π", en:"Stand up"},{uk:"–ô–¥–∏ —Å—é–¥–∏", en:"Come here"},
    {uk:"–î–∞–π –º–µ–Ω—ñ", en:"Give me"},{uk:"–í—ñ–∑—å–º–∏", en:"Take it"},{uk:"–ü–æ–∫–ª–∞–¥–∏", en:"Put it down"},
    {uk:"–ü–æ–∫–∞–∂–∏", en:"Show me"},{uk:"–í—ñ–¥–∫—Ä–∏–π —Ä–æ—Ç–∏–∫", en:"Open your mouth"},{uk:"–ó–∞–∫—Ä–∏–π –æ—á–µ–Ω—è—Ç–∞", en:"Close your little eyes"},
    {uk:"–ú–∏—î–º–æ —Ä—É—á–∫–∏", en:"We are washing hands"},{uk:"–ù–µ —Ç–æ—Ä–∫–∞–π—Å—è", en:"Don't touch"},{uk:"–ù–µ –∫–ª–∞–¥–∏ –≤ —Ä–æ—Ç", en:"Don't put it in your mouth"},
    {uk:"–ü–æ–¥—ñ–ª–∏—Å—è, –±—É–¥—å –ª–∞—Å–∫–∞", en:"Share, please"},{uk:"–ü–æ–≤—ñ–ª—å–Ω–æ", en:"Slowly"},{uk:"–®–≤–∏–¥—à–µ", en:"Faster"}
  ]},
  kid_feeding: { name:"Feeding & eating", type:"vocab", items: [
    {uk:"—ó–∂–∞", en:"food"},{uk:"–∫–∞—à–∞", en:"porridge"},{uk:"–±–∞–Ω–∞–Ω", en:"banana"},{uk:"–π–æ–≥—É—Ä—Ç", en:"yogurt"},
    {uk:"–æ–≤–æ—á—ñ", en:"vegetables"},{uk:"—Ñ—Ä—É–∫—Ç–∏", en:"fruits"},{uk:"–≤–æ–¥–∞", en:"water"},{uk:"—Å—ñ–∫", en:"juice"},
    {uk:"–ø–ª—è—à–µ—á–∫–∞", en:"bottle"},{uk:"—Å—É–º—ñ—à (–¥–ª—è –Ω–µ–º–æ–≤–ª—è—Ç)", en:"formula"},{uk:"–ª–æ–∂–∫–∞", en:"spoon"},{uk:"—Ç–∞—Ä—ñ–ª–∫–∞", en:"plate"},
    {uk:"–á–∂ –ø–æ–≤—ñ–ª—å–Ω–æ", en:"Eat slowly"},{uk:"–ñ—É–π", en:"Chew"},{uk:"–ü–∏–π –≤–æ–¥–∏—á–∫—É", en:"Drink some water"},
    {uk:"–©–µ?", en:"More?"},{uk:"–î–æ—Å–∏—Ç—å", en:"Enough"},{uk:"–°–º–∞—á–Ω–æ?", en:"Is it tasty?"}
  ]},
  kid_diaper: { name:"Diapering & potty", type:"vocab", items: [
    {uk:"–ø—ñ–¥–≥—É–∑–æ–∫ / –ø–∞–º–ø–µ—Ä—Å", en:"diaper"},{uk:"—Å–µ—Ä–≤–µ—Ç–∫–∏", en:"wipes"},{uk:"–∫—Ä–µ–º", en:"cream"},
    {uk:"–≥–æ—Ä—â–∏–∫", en:"potty"},{uk:"–ø—ñ—Å—è", en:"pee (kid)"},{uk:"–∫–∞–∫–∞", en:"poop (kid)"},
    {uk:"–¢—Ä–µ–±–∞ –ø–æ–º—ñ–Ω—è—Ç–∏ –ø—ñ–¥–≥—É–∑–æ–∫", en:"We need to change your diaper"},
    {uk:"–ü—ñ–¥—Ç–∏—Å–∫–∞–π –Ω—ñ–∂–∫–∏", en:"Lift your legs"},{uk:"–ß–∏—Å—Ç–æ", en:"All clean"},
    {uk:"–¢–∏ –ø–æ–ø—ñ—Å—è–≤/–ø–æ–ø—ñ—Å—è–ª–∞?", en:"Did you pee? (m/f)"}
  ]},
  kid_sleep: { name:"Sleep & nap time", type:"vocab", items: [
    {uk:"—Å–ø–∞—Ç–∫–∏", en:"sleepy time (kid)"},{uk:"—Å–æ–Ω", en:"sleep"},{uk:"–¥—Ä—ñ–º–∞—Ç–∏", en:"to nap"},
    {uk:"–ø—ñ–∂–∞–º–∞", en:"pyjamas"},{uk:"–∫–æ–≤–¥—Ä–∞", en:"blanket"},{uk:"–ü–æ–¥—É—à–∫–∞", en:"pillow"},
    {uk:"–ü–æ—Ä–∞ —Å–ø–∞—Ç–∫–∏", en:"Time to sleep"},{uk:"–•–æ–¥—ñ–º–æ —Å–ø–∞—Ç–∏", en:"Let's go to sleep"},
    {uk:"–Ø –ø–æ—Ä—É—á", en:"I'm here"},{uk:"–ù–µ –±—ñ–π—Å—è", en:"Don't be afraid"},{uk:"–¢–∏—Ö–æ", en:"Quiet"},
    {uk:"–ó–∞–∫—Ä–∏–π –æ—á–µ–Ω—è—Ç–∞", en:"Close your little eyes"},{uk:"–õ—é–ª—ñ-–ª—é–ª—ñ", en:"lullaby (soothing words)"}
  ]},
  kid_play: { name:"Playtime & activities", type:"vocab", items: [
    {uk:"–ì–∞–π–¥–∞ –≥—Ä–∞—Ç–∏—Å—è!", en:"Let's play!"},{uk:"–î–∞–≤–∞–π –±—É–¥—É–≤–∞—Ç–∏ –≤–µ–∂—É", en:"Let's build a tower"},
    {uk:"–ö–∏–¥–∞–π –º'—è—á", en:"Throw the ball"},{uk:"–õ–æ–≤–∏!", en:"Catch!"},{uk:"–ú–∞–ª—é–π", en:"Draw"},
    {uk:"–†–æ–∑—Ñ–∞—Ä–±–æ–≤—É–π", en:"Color (verb)"},{uk:"–ß–∏—Ç–∞–π–º–æ –∫–Ω–∏–∂–∫—É", en:"Let's read a book"},
    {uk:"–°–ø—ñ–≤–∞–π–º–æ", en:"Let's sing"},{uk:"–¢–∞–Ω—Ü—é–π–º–æ", en:"Let's dance"},
    {uk:"–î—ñ–ª–∏—Å—è —ñ–≥—Ä–∞—à–∫–∞–º–∏", en:"Share your toys"},{uk:"–ü—Ä–∏–±–µ—Ä–∏ —ñ–≥—Ä–∞—à–∫–∏", en:"Put your toys away"}
  ]},
  kid_safety: { name:"Safety words", type:"vocab", items: [
    {uk:"–≥–∞—Ä—è—á–µ", en:"hot"},{uk:"—Ö–æ–ª–æ–¥–Ω–æ", en:"cold"},{uk:"–±–æ–ª—è—á–µ", en:"it hurts"},
    {uk:"–Ω–µ–±–µ–∑–ø–µ—á–Ω–æ", en:"dangerous"},{uk:"–æ–±–µ—Ä–µ–∂–Ω–æ", en:"careful"},{uk:"—Å—Ç—ñ–π", en:"stop"},
    {uk:"–ø–æ–≤—ñ–ª—å–Ω–æ", en:"slowly"},{uk:"–Ω–µ —á—ñ–ø–∞–π", en:"don't touch"},{uk:"–Ω–µ –∫–ª–∞–¥–∏ –≤ —Ä–æ—Ç", en:"don't put it in your mouth"},
    {uk:"—Ç—Ä–∏–º–∞–π—Å—è –∑–∞ —Ä—É–∫—É", en:"hold my hand"}
  ]},
  kid_feelings: { name:"Feelings (kid)", type:"vocab", items: [
    {uk:"–ú–µ–Ω—ñ –∂–∞—Ä–∫–æ", en:"I'm hot"},{uk:"–ú–µ–Ω—ñ —Ö–æ–ª–æ–¥–Ω–æ", en:"I'm cold"},
    {uk:"–ú–µ–Ω—ñ —Å—Ç—Ä–∞—à–Ω–æ", en:"I'm scared"},{uk:"–ú–µ–Ω—ñ –±–æ–ª—è—á–µ", en:"It hurts"},
    {uk:"–ú–µ–Ω—ñ —Å—É–º–Ω–æ", en:"I'm sad"},{uk:"–ú–µ–Ω—ñ –≤–µ—Å–µ–ª–æ", en:"I'm having fun"},
    {uk:"–Ø –≤—Ç–æ–º–∏–≤—Å—è / –≤—Ç–æ–º–∏–ª–∞—Å—è", en:"I'm tired (m/f)"},{uk:"–Ø —Ö–æ—á—É —ó—Å—Ç–∏", en:"I'm hungry"},
    {uk:"–Ø —Ö–æ—á—É –ø–∏—Ç–∏", en:"I'm thirsty"}
  ]},
  animals_kids: { name:"Animals (kid-friendly)", type:"vocab", items: [
    {uk:"–∫—ñ—Ç / –∫–∏—Ü—è", en:"cat / kitty"},{uk:"–ø–µ—Å / —Å–æ–±–∞—á–∫–∞", en:"dog / doggy"},
    {uk:"–∫–æ—Ä–æ–≤–∞", en:"cow"},{uk:"–≤—ñ–≤—Ü—è", en:"sheep"},{uk:"—Å–≤–∏–Ω—è", en:"pig"},
    {uk:"–∫—É—Ä–∫–∞ / –∫—É—Ä—á–∞—Ç–∫–æ", en:"chicken / chick"},{uk:"–∫–∞—á–∫–∞ / –∫–∞—á–µ–Ω—è", en:"duck / duckling"},
    {uk:"–∫—ñ–Ω—å / –ª–æ—à–∞", en:"horse / foal"},{uk:"–ø—Ç–∞—à–∫–∞", en:"birdie"},
    {uk:"—Ä–∏–±–∫–∞", en:"little fish"},{uk:"–≤–µ–¥–º–µ–¥–∏–∫", en:"teddy bear"}
  ]},
  animal_sounds: { name:"Animal sounds (text)", type:"vocab", items: [
    {uk:"–Ω—è–≤-–Ω—è–≤", en:"meow"},{uk:"–≥–∞–≤-–≥–∞–≤", en:"woof"},{uk:"–º—É-—É", en:"moo"},
    {uk:"–∫–æ-–∫–æ-–∫–æ", en:"cluck"},{uk:"—ñ-–≥–æ-–≥–æ", en:"neigh"},{uk:"—Ö—Ä—é-—Ö—Ä—é", en:"oink"},{uk:"–±–µ-–µ", en:"baa"},{uk:"–∫—Ä—è-–∫—Ä—è", en:"quack"},{uk:"–∫–≤–∞-–∫–≤–∞", en:"ribbit"}
  ]},
  /* NEW: Media deck for Library (emoji + onomatopoeia; answers in Ukrainian) */
  animal_sounds_media: { name:"Animal Sounds (with pictures)", type:"media", mode:"animal-sounds-uk", items: [
    {animal:"cat", emoji:"üê±", uk:"–Ω—è–≤-–Ω—è–≤", en:"meow"},
    {animal:"dog", emoji:"üê∂", uk:"–≥–∞–≤-–≥–∞–≤", en:"woof"},
    {animal:"cow", emoji:"üêÆ", uk:"–º—É-—É", en:"moo"},
    {animal:"horse", emoji:"üê¥", uk:"—ñ-–≥–æ-–≥–æ", en:"neigh"},
    {animal:"pig", emoji:"üê∑", uk:"—Ö—Ä—é-—Ö—Ä—é", en:"oink"},
    {animal:"chicken", emoji:"üêî", uk:"–∫–æ-–∫–æ-–∫–æ", en:"cluck"},
    {animal:"sheep", emoji:"üêë", uk:"–±–µ-–µ", en:"baa"},
    {animal:"duck", emoji:"ü¶Ü", uk:"–∫—Ä—è-–∫—Ä—è", en:"quack"},
    {animal:"frog", emoji:"üê∏", uk:"–∫–≤–∞-–∫–≤–∞", en:"ribbit"}
  ]},

  /* Grammar decks (case questions) */
  cases_basic: { name:"Grammar ‚Äî Cases (basic)", type:"case", items: [
    { sentence:"–Ø –±–∞—á—É _____ (–∫—ñ—Ç).", choices:["–∫—ñ—Ç","–∫–æ—Ç–∞","–∫–æ—Ç—ñ","–∫–æ—Ç–æ–º"], answer:1, explanation:"Accusative singular, animate masculine nouns often take -–∞/-—è ‚Üí –∫—ñ—Ç ‚Üí –∫–æ—Ç–∞." },
    { sentence:"–Ø –∫—É–ø—É—é _____ (–∫–Ω–∏–∂–∫–∞).", choices:["–∫–Ω–∏–∂–∫–∞","–∫–Ω–∏–∂–∫—É","–∫–Ω–∏–∂–∫–æ—é","–∫–Ω–∏–∂—Ü—ñ"], answer:1, explanation:"Accusative singular, feminine -–∞ ‚Üí -—É ‚Üí –∫–Ω–∏–∂–∫–∞ ‚Üí –∫–Ω–∏–∂–∫—É." },
    { sentence:"–£ –º–µ–Ω–µ –Ω–µ–º–∞—î _____ (—á–∞—Å).", choices:["—á–∞—Å","—á–∞—Å—É","—á–∞—Å–æ–º","—á–∞—Å—ñ"], answer:1, explanation:"Genitive after ¬´–Ω–µ–º–∞—î¬ª ‚Üí —á–∞—Å ‚Üí —á–∞—Å—É." },
    { sentence:"–Ø –¥–æ–ø–æ–º–∞–≥–∞—é _____ (–¥—Ä—É–≥).", choices:["–¥—Ä—É–≥","–¥—Ä—É–≥–∞","–¥—Ä—É–≥—É","–¥—Ä—É–≥–æ–º"], answer:2, explanation:"Dative singular answers ‚Äò–∫–æ–º—É?‚Äô ‚Üí –¥—Ä—É–≥ ‚Üí –¥—Ä—É–≥—É." },
    { sentence:"–í–æ–Ω–∞ –ø–∏—à–∞—î—Ç—å—Å—è _____ (—É—Å–ø—ñ—Ö).", choices:["—É—Å–ø—ñ—Ö","—É—Å–ø—ñ—Ö–æ–º","—É—Å–ø—ñ—Ö—É","—É—Å–ø—ñ—Ö–æ–≤—ñ"], answer:1, explanation:"Instrumental after ¬´–ø–∏—à–∞—Ç–∏—Å—è¬ª ‚Üí —É—Å–ø—ñ—Ö ‚Üí —É—Å–ø—ñ—Ö–æ–º." },
    { sentence:"–ú–∏ –∂–∏–≤–µ–º–æ –≤ _____ (–ö–∏—ó–≤).", choices:["–ö–∏—ó–≤","–ö–∏—î–≤–∞","–ö–∏—î–≤—ñ","–ö–∏—î–≤–æ–º"], answer:2, explanation:"Locative after ¬´–≤/—É¬ª (location) ‚Üí –ö–∏—ó–≤ ‚Üí –ö–∏—î–≤—ñ." },
    { sentence:"_____ (–¥—Ä—É–∑—ñ), –ø—Ä–∏–≤—ñ—Ç!", choices:["–î—Ä—É–∑—ñ","–î—Ä—É–∑—ñ–≤","–î—Ä—É–∑—è–º–∏","–î—Ä—É–∑—è—Ö"], answer:0, explanation:"Vocative plural often = nominative plural ‚Üí –¥—Ä—É–∑—ñ." },
    { sentence:"–Ø –π–¥—É –¥–æ _____ (—à–∫–æ–ª–∞).", choices:["—à–∫–æ–ª–∞","—à–∫–æ–ª—É","—à–∫–æ–ª–∏","—à–∫–æ–ª–æ—é"], answer:2, explanation:"Preposition ¬´–¥–æ¬ª takes genitive ‚Üí —à–∫–æ–ª–∞ ‚Üí —à–∫–æ–ª–∏." },
    { sentence:"–Ø –≥–æ–≤–æ—Ä—é –∑ _____ (–≤—á–∏—Ç–µ–ª—å).", choices:["–≤—á–∏—Ç–µ–ª—å","–≤—á–∏—Ç–µ–ª—è","–≤—á–∏—Ç–µ–ª—é","–≤—á–∏—Ç–µ–ª–µ–º"], answer:3, explanation:"¬´–∑/—ñ–∑/–∑—ñ¬ª with instrumental ‚Üí –≤—á–∏—Ç–µ–ª—å ‚Üí –≤—á–∏—Ç–µ–ª–µ–º." },
    { sentence:"–ú–∏ –Ω–∞ _____ (—É—Ä–æ–∫).", choices:["—É—Ä–æ–∫","—É—Ä–æ–∫—É","—É—Ä–æ–∫–æ–≤—ñ","—É—Ä–æ—Ü—ñ"], answer:3, explanation:"Location with ¬´–Ω–∞¬ª frequently uses locative ‚Üí —É—Ä–æ—Ü—ñ." },
    { sentence:"–Ø –ª—é–±–ª—é _____ (–∫–∞–≤–∞).", choices:["–∫–∞–≤–∞","–∫–∞–≤–∏","–∫–∞–≤—É","–∫–∞–≤–æ—é"], answer:2, explanation:"Direct object (accusative) ‚Üí –∫–∞–≤–∞ ‚Üí –∫–∞–≤—É." },
    { sentence:"–î–∞–π _____ (—Å–µ—Å—Ç—Ä–∞) –∫–Ω–∏–≥—É.", choices:["—Å–µ—Å—Ç—Ä–∞","—Å–µ—Å—Ç—Ä–∏","—Å–µ—Å—Ç—Ä—ñ","—Å–µ—Å—Ç—Ä–æ—é"], answer:2, explanation:"Indirect object (dative) ‚Üí —Å–µ—Å—Ç—Ä—ñ." },
    { sentence:"–ú–∏ –≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ _____ (–º—É–∑–∏–∫–∞).", choices:["–º—É–∑–∏–∫–∞","–º—É–∑–∏–∫–∏","–º—É–∑–∏—Ü—ñ","–º—É–∑–∏–∫—É"], answer:3, explanation:"¬´–ø—Ä–æ¬ª takes accusative ‚Üí –º—É–∑–∏–∫—É." },
    { sentence:"–í—ñ–Ω —î _____ (—Å—Ç—É–¥–µ–Ω—Ç).", choices:["—Å—Ç—É–¥–µ–Ω—Ç","—Å—Ç—É–¥–µ–Ω—Ç–∞","—Å—Ç—É–¥–µ–Ω—Ç–æ–º","—Å—Ç—É–¥–µ–Ω—Ç–æ–≤—ñ"], answer:2, explanation:"Predicate instrumental possible with ¬´–±—É—Ç–∏¬ª ‚Üí —Å—Ç—É–¥–µ–Ω—Ç–æ–º." }
  ]},
  cases_instrumental: { name:"Grammar ‚Äî Instrumental", type:"case", items: [
    { sentence:"–í—ñ–Ω –ø—Ä–∞—Ü—é—î _____ (–ª—ñ–∫–∞—Ä).", choices:["–ª—ñ–∫–∞—Ä","–ª—ñ–∫–∞—Ä–µ–º","–ª—ñ–∫–∞—Ä—é","–ª—ñ–∫–∞—Ä—è"], answer:1, explanation:"Profession after ¬´–ø—Ä–∞—Ü—é–≤–∞—Ç–∏¬ª can use instrumental ‚Üí –ª—ñ–∫–∞—Ä–µ–º." },
    { sentence:"–í–æ–Ω–∞ –ø–∏—à–∞—î—Ç—å—Å—è —Å–≤–æ—ó–º _____ (–±—Ä–∞—Ç).", choices:["–±—Ä–∞—Ç","–±—Ä–∞—Ç–æ–≤—ñ","–±—Ä–∞—Ç–æ–º","–±—Ä–∞—Ç–∞"], answer:2, explanation:"After ¬´–ø–∏—à–∞—Ç–∏—Å—è¬ª use instrumental ‚Üí –±—Ä–∞—Ç–æ–º." },
    { sentence:"–ú–∏ –ø–æ–¥–æ—Ä–æ–∂—É—î–º–æ –∑ _____ (–¥—Ä—É–≥).", choices:["–¥—Ä—É–≥–∞","–¥—Ä—É–≥–æ–º","–¥—Ä—É–∑—è–º–∏","–¥—Ä—É–≥–æ–≤—ñ"], answer:1, explanation:"¬´–∑¬ª + instrumental ‚Üí –∑ –¥—Ä—É–≥–æ–º." },
    { sentence:"–í—ñ–Ω —Ü—ñ–∫–∞–≤–∏—Ç—å—Å—è _____ (—ñ—Å—Ç–æ—Ä—ñ—è).", choices:["—ñ—Å—Ç–æ—Ä—ñ—î—é","—ñ—Å—Ç–æ—Ä—ñ—é","—ñ—Å—Ç–æ—Ä—ñ—ó","—ñ—Å—Ç–æ—Ä—ñ—è"], answer:0, explanation:"¬´—Ü—ñ–∫–∞–≤–∏—Ç–∏—Å—è¬ª takes instrumental ‚Üí —ñ—Å—Ç–æ—Ä—ñ—î—é." },
    { sentence:"–í–æ–Ω–∞ –ø–∏—à–µ _____ (–æ–ª—ñ–≤–µ—Ü—å).", choices:["–æ–ª—ñ–≤–µ—Ü—å","–æ–ª—ñ–≤—Ü–µ–º","–æ–ª—ñ–≤—Ü—é","–æ–ª—ñ–≤—Ü—è"], answer:1, explanation:"Instrument used ‚Üí —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π: –æ–ª—ñ–≤—Ü–µ–º." },
    { sentence:"–ú–∏ –∑—É—Å—Ç—Ä—ñ–ª–∏—Å—è –∑ _____ (–¥–∏—Ä–µ–∫—Ç–æ—Ä).", choices:["–¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–º","–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞","–¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤—ñ","–¥–∏—Ä–µ–∫—Ç–æ—Ä—É"], answer:0, explanation:"¬´–∑¬ª + instrumental ‚Üí –∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–º." },
    { sentence:"–í—ñ–Ω —Å—Ç–∞–≤ _____ (—É—á–∏—Ç–µ–ª—å).", choices:["—É—á–∏—Ç–µ–ª–µ–º","—É—á–∏—Ç–µ–ª—è","—É—á–∏—Ç–µ–ª—é","—É—á–∏—Ç–µ–ª—å"], answer:0, explanation:"Becoming often uses instrumental ‚Üí —É—á–∏—Ç–µ–ª–µ–º." },
    { sentence:"–í–æ–Ω–∞ –≥–æ–≤–æ—Ä–∏–ª–∞ –∑ _____ (—Å—É—Å—ñ–¥–∫–∞).", choices:["—Å—É—Å—ñ–¥–∫–æ—é","—Å—É—Å—ñ–¥–∫—É","—Å—É—Å—ñ–¥—Ü—ñ","—Å—É—Å—ñ–¥–∫–∞"], answer:0, explanation:"Instrumental singular feminine -–æ—é/-–µ—é ‚Üí —Å—É—Å—ñ–¥–∫–æ—é." }
  ]},
  cases_locative: { name:"Grammar ‚Äî Locative", type:"case", items: [
    { sentence:"–í–æ–Ω–∏ –∂–∏–≤—É—Ç—å —É _____ (–ö–∏—ó–≤).", choices:["–ö–∏—î–≤—ñ","–ö–∏—î–≤–∞","–ö–∏—ó–≤","–ö–∏—î–≤–æ–º"], answer:0, explanation:"Location with ¬´—É/–≤¬ª ‚Üí —É –ö–∏—î–≤—ñ." },
    { sentence:"–ú–∏ –Ω–∞ _____ (–ª–µ–∫—Ü—ñ—è).", choices:["–ª–µ–∫—Ü—ñ—ó","–ª–µ–∫—Ü—ñ—é","–ª–µ–∫—Ü—ñ—î—é","–ª–µ–∫—Ü—ñ–π"], answer:0, explanation:"Location with ¬´–Ω–∞¬ª ‚Üí –Ω–∞ –ª–µ–∫—Ü—ñ—ó." },
    { sentence:"–í–æ–Ω–∞ –ø—Ä–∞—Ü—é—î –≤ _____ (–æ—Ñ—ñ—Å).", choices:["–æ—Ñ—ñ—Å—ñ","–æ—Ñ—ñ—Å—É","–æ—Ñ—ñ—Å–æ–º","–æ—Ñ—ñ—Å—ñ (acc.)"], answer:0, explanation:"Where? ‚Üí –≤ –æ—Ñ—ñ—Å—ñ." },
    { sentence:"–Ø –≤ _____ (–º—É–∑–µ–π).", choices:["–º—É–∑–µ—ó","–º—É–∑–µ—î–º","–º—É–∑–µ—é","–º—É–∑–µ–π"], answer:0, explanation:"Location ‚Üí —É –º—É–∑–µ—ó." },
    { sentence:"–í—ñ–Ω –Ω–∞ _____ (—Å—Ç–∞–¥—ñ–æ–Ω).", choices:["—Å—Ç–∞–¥—ñ–æ–Ω—ñ","—Å—Ç–∞–¥—ñ–æ–Ω—É","—Å—Ç–∞–¥—ñ–æ–Ω–æ–º","—Å—Ç–∞–¥—ñ–æ–Ω"], answer:0, explanation:"Location with ¬´–Ω–∞¬ª ‚Üí –Ω–∞ —Å—Ç–∞–¥—ñ–æ–Ω—ñ." },
    { sentence:"–ú–∏ –≤ _____ (—à–∫–æ–ª–∞).", choices:["—à–∫–æ–ª—ñ","—à–∫–æ–ª–æ—é","—à–∫–æ–ª–∏","—à–∫–æ–ª—É"], answer:0, explanation:"Feminine locative -—ñ ‚Üí —É —à–∫–æ–ª—ñ." },
    { sentence:"–Ø –Ω–∞ _____ (—Ä–æ–±–æ—Ç–∞).", choices:["—Ä–æ–±–æ—Ç—ñ","—Ä–æ–±–æ—Ç–æ—é","—Ä–æ–±–æ—Ç–∏","—Ä–æ–±–æ—Ç—É"], answer:0, explanation:"Locative: –Ω–∞ —Ä–æ–±–æ—Ç—ñ." },
    { sentence:"–í—ñ–Ω —É _____ (—Å–µ–ª–æ).", choices:["—Å–µ–ª—ñ","—Å–µ–ª—É","—Å–µ–ª–æ–º","—Å–µ–ª–∞"], answer:0, explanation:"Neuter locative -—ñ ‚Üí —É —Å–µ–ª—ñ." }
  ]},

  /* More grammar & vocab decks */
  grammar_imperatives: { name:"Grammar ‚Äî Imperatives (kid)", type:"case", items:[
    { sentence:"_____ , –±—É–¥—å –ª–∞—Å–∫–∞. (sit down)", choices:["–°—è–¥—å","–°—ñ–¥–∞–π","–°–∏–¥–∏—à","–°—ñ—Å—Ç–∏"], answer:1, explanation:"¬´–°—ñ–¥–∞–π¬ª (gentle ongoing). ¬´–°—è–¥—å¬ª is single-action." },
    { sentence:"_____ —Ä—É–∫–∏. (wash)", choices:["–ú–∏–π","–ú–∏–π—Ç–µ","–ú–∏–ª–∏","–ú–∏–≤"], answer:0, explanation:"2sg imperative: ¬´–ú–∏–π —Ä—É–∫–∏¬ª." },
    { sentence:"_____ —Å—é–¥–∏. (come)", choices:["–ô–¥–∏","–ü—ñ—à–æ–≤","–ô–¥–µ—à","–ô—Ç–∏"], answer:0, explanation:"2sg imperative: ¬´–ô–¥–∏ —Å—é–¥–∏¬ª." },
    { sentence:"_____ —Ä–æ—Ç–∏–∫. (open)", choices:["–í—ñ–¥–∫—Ä–∏–π","–í—ñ–¥–∫—Ä–∏–≤–∞–π","–í—ñ–¥–∫—Ä–∏—Ç–æ","–í—ñ–¥–∫—Ä–∏–≤"], answer:0, explanation:"Immediate command: ¬´–í—ñ–¥–∫—Ä–∏–π —Ä–æ—Ç–∏–∫¬ª." },
    { sentence:"_____ —ñ–≥—Ä–∞—à–∫–∏. (put away)", choices:["–ü—Ä–∏–±–µ—Ä–∏","–ü—Ä–∏–±–∏—Ä–∞–π","–ü—Ä–∏–±–∏—Ä–∞–≤","–ü—Ä–∏–±—Ä–∞–Ω–∏–π"], answer:0, explanation:"2sg imperative: ¬´–ü—Ä–∏–±–µ—Ä–∏ —ñ–≥—Ä–∞—à–∫–∏¬ª." }
  ]},
  grammar_possessives: { name:"Grammar ‚Äî Possessives", type:"case", items:[
    { sentence:"–¶–µ _____ —ñ–≥—Ä–∞—à–∫–∞. (she)", choices:["—ó—ó","–π–æ–≥–æ","—Ç–≤–æ—è","–Ω–∞—à–∞"], answer:0, explanation:"¬´—ó—ó¬ª = her (invariable)." },
    { sentence:"–î–µ _____ –ø–ª—è—à–µ—á–∫–∞? (you, sg.)", choices:["—Ç–≤–æ—è","—Ç–≤–æ—ó–π","—Ç–≤–æ—î—é","—Ç–≤—ñ–π"], answer:0, explanation:"Nom. fem. ‚Üí ¬´—Ç–≤–æ—è –ø–ª—è—à–µ—á–∫–∞¬ª." },
    { sentence:"–¶–µ _____ –º'—è—á. (we)", choices:["–Ω–∞—à","–Ω–∞—à–∞","–Ω–∞—à–µ","–Ω–∞—à—ñ"], answer:0, explanation:"Nom. masc. ‚Üí ¬´–Ω–∞—à –º'—è—á¬ª." },
    { sentence:"–Ø —Ç—Ä–∏–º–∞—é _____ —Ä—É–∫—É. (you, sg.)", choices:["—Ç–≤–æ—é","—Ç–≤–æ—è","—Ç–≤–æ—ó–π","—Ç–≤–æ—î—é"], answer:0, explanation:"Acc. fem. ‚Üí ¬´—Ç–≤–æ—é —Ä—É–∫—É¬ª." }
  ]},
  grammar_present: { name:"Grammar ‚Äî Present tense", type:"case", items:[
    {sentence:"–Ø _____ (—ó—Å—Ç–∏) –∫–∞—à—É.", choices:["—ó–º","—ó—Å–∏","—ó—Å—Ç—å","—ó–º–æ"], answer:0, explanation:"1sg present: —è —ó–º."},
    {sentence:"–í–æ–Ω–∞ _____ (–ø–∏—Ç–∏) –º–æ–ª–æ–∫–æ.", choices:["–ø'—î","–ø'—é","–ø'—î—à","–ø'—é—Ç—å"], answer:0, explanation:"3sg present: –≤–æ–Ω–∞ –ø'—î."},
    {sentence:"–ú–∏ _____ (—á–∏—Ç–∞—Ç–∏) –∫–Ω–∏–∂–∫—É.", choices:["—á–∏—Ç–∞—î–º–æ","—á–∏—Ç–∞—î","—á–∏—Ç–∞—é—Ç—å","—á–∏—Ç–∞—é"], answer:0, explanation:"1pl present: –º–∏ —á–∏—Ç–∞—î–º–æ."},
    {sentence:"–í–æ–Ω–∏ _____ (–ø–∏—Å–∞—Ç–∏) –ª–∏—Å—Ç–∏.", choices:["–ø–∏—à—É—Ç—å","–ø–∏—à–µ","–ø–∏—à–µ–º–æ","–ø–∏—à–µ—à"], answer:0, explanation:"3pl present: –≤–æ–Ω–∏ –ø–∏—à—É—Ç—å."},
    {sentence:"–¢–∏ _____ (–π—Ç–∏) –¥–æ–¥–æ–º—É.", choices:["–π–¥–µ—à","–π–¥—É—Ç—å","–π–¥–µ—Ç–µ","–π–¥—É"], answer:0, explanation:"2sg present: —Ç–∏ –π–¥–µ—à."},
    {sentence:"–í—ñ–Ω _____ (–±–∞—á–∏—Ç–∏) –º'—è—á.", choices:["–±–∞—á–∏—Ç—å","–±–∞—á–∞—Ç—å","–±–∞—á–∏–º–æ","–±–∞—á–∏—à"], answer:0, explanation:"3sg present: –≤—ñ–Ω –±–∞—á–∏—Ç—å."},
    {sentence:"–ú–∏ _____ (–ø—Ä–∞—Ü—é–≤–∞—Ç–∏) —Ä–∞–∑–æ–º.", choices:["–ø—Ä–∞—Ü—é—î–º–æ","–ø—Ä–∞—Ü—é—î","–ø—Ä–∞—Ü—é—é—Ç—å","–ø—Ä–∞—Ü—é—é"], answer:0, explanation:"1pl present: –º–∏ –ø—Ä–∞—Ü—é—î–º–æ."},
    {sentence:"–Ø _____ (–∫–∞–∑–∞—Ç–∏) –ø—Ä–∞–≤–¥—É.", choices:["–∫–∞–∂—É","–∫–∞–∂–µ","–∫–∞–∂–µ—à","–∫–∞–∂–µ–º–æ"], answer:0, explanation:"1sg present: —è –∫–∞–∂—É."}
  ]},
  grammar_past: { name:"Grammar ‚Äî Past tense", type:"case", items:[
    {sentence:"–í—ñ–Ω _____ (—ó—Å—Ç–∏) —Å—É–ø —É—á–æ—Ä–∞.", choices:["—ó–≤","—ó–ª–∞","—ó–ª–∏","—ó—Å—Ç—å"], answer:0, explanation:"Past masc.: –≤—ñ–Ω —ó–≤."},
    {sentence:"–í–æ–Ω–∞ _____ (–ø–∏—Ç–∏) –≤–æ–¥—É.", choices:["–ø–∏–ª–∞","–ø–∏–≤","–ø–∏–ª–∏","–ø'—î"], answer:0, explanation:"Past fem.: –≤–æ–Ω–∞ –ø–∏–ª–∞."},
    {sentence:"–í–æ–Ω–∏ _____ (–π—Ç–∏) –¥–æ–¥–æ–º—É.", choices:["–π—à–ª–∏","–π—à–æ–≤","–π—à–ª–∞","–π–¥—É—Ç—å"], answer:0, explanation:"Past plural: –≤–æ–Ω–∏ –π—à–ª–∏."},
    {sentence:"–Ø (–∂—ñ–Ω.) _____ (—á–∏—Ç–∞—Ç–∏) –∫–Ω–∏–≥—É.", choices:["—á–∏—Ç–∞–ª–∞","—á–∏—Ç–∞–≤","—á–∏—Ç–∞–ª–∏","—á–∏—Ç–∞—é"], answer:0, explanation:"Past fem.: —è —á–∏—Ç–∞–ª–∞."},
    {sentence:"–Ø (—á–æ–ª.) _____ (–ø—Ä–∞—Ü—é–≤–∞—Ç–∏) –±–∞–≥–∞—Ç–æ.", choices:["–ø—Ä–∞—Ü—é–≤–∞–≤","–ø—Ä–∞—Ü—é–≤–∞–ª–∞","–ø—Ä–∞—Ü—é–≤–∞–ª–∏","–ø—Ä–∞—Ü—é—î"], answer:0, explanation:"Past masc.: —è –ø—Ä–∞—Ü—é–≤–∞–≤."},
    {sentence:"–í–æ–Ω–æ _____ (—Å–ø–∞—Ç–∏) –º—ñ—Ü–Ω–æ.", choices:["—Å–ø–∞–ª–æ","—Å–ø–∞–≤","—Å–ø–∞–ª–∞","—Å–ø–ª—è—Ç—å"], answer:0, explanation:"Past neuter: –≤–æ–Ω–æ —Å–ø–∞–ª–æ."},
    {sentence:"–ú–∏ _____ (–≥—Ä–∞—Ç–∏—Å—è) –≤ –ø–∞—Ä–∫—É.", choices:["–≥—Ä–∞–ª–∏—Å—è","–≥—Ä–∞–≤—Å—è","–≥—Ä–∞–ª–∞—Å—è","–≥—Ä–∞—é—Ç—å—Å—è"], answer:0, explanation:"Past plural reflexive: –º–∏ –≥—Ä–∞–ª–∏—Å—è."}
  ]},
  grammar_prepositions: { name:"Grammar ‚Äî Prepositions (motion vs location)", type:"case", items:[
    {sentence:"–ö–ª–∞–¥—É —ñ–≥—Ä–∞—à–∫—É _____ (–∫–æ—Ä–æ–±–∫–∞).", choices:["–≤ –∫–æ—Ä–æ–±–∫—É","—É –∫–æ—Ä–æ–±—Ü—ñ","–¥–æ –∫–æ—Ä–æ–±–∫–∏","–Ω–∞ –∫–æ—Ä–æ–±–∫—É"], answer:0, explanation:"Motion into ‚Üí Acc.: –≤ –∫–æ—Ä–æ–±–∫—É."},
    {sentence:"–Ü–≥—Ä–∞—à–∫–∞ –ª–µ–∂–∏—Ç—å _____ (–∫–æ—Ä–æ–±–∫–∞).", choices:["—É –∫–æ—Ä–æ–±—Ü—ñ","–≤ –∫–æ—Ä–æ–±–∫—É","–Ω–∞ –∫–æ—Ä–æ–±–∫—É","–¥–æ –∫–æ—Ä–æ–±–∫–∏"], answer:0, explanation:"Location ‚Üí Loc.: —É –∫–æ—Ä–æ–±—Ü—ñ."},
    {sentence:"–ú–∏ –π–¥–µ–º–æ _____ (–ø–∞—Ä–∫).", choices:["–¥–æ –ø–∞—Ä–∫—É","—É –ø–∞—Ä–∫—É","–≤ –ø–∞—Ä–∫—É","–Ω–∞ –ø–∞—Ä–∫—É"], answer:0, explanation:"‚Äòto‚Äô a place ‚Üí –¥–æ + Gen.: –¥–æ –ø–∞—Ä–∫—É."},
    {sentence:"–ú'—è—á –ª–µ–∂–∏—Ç—å _____ (—Å—Ç—ñ–ª).", choices:["–Ω–∞ —Å—Ç–æ–ª—ñ","–Ω–∞ —Å—Ç—ñ–ª","—É —Å—Ç–æ–ª—ñ","–¥–æ —Å—Ç–æ–ª—É"], answer:0, explanation:"Location ‚Äòon‚Äô ‚Üí –Ω–∞ + Loc.: –Ω–∞ —Å—Ç–æ–ª—ñ."},
    {sentence:"–í—ñ–Ω –∫–ª–∞–¥–µ –∫–Ω–∏–∂–∫—É _____ (—Å—Ç—ñ–ª).", choices:["–Ω–∞ —Å—Ç—ñ–ª","–Ω–∞ —Å—Ç–æ–ª—ñ","—É —Å—Ç–æ–ª—ñ","–¥–æ —Å—Ç–æ–ª—É"], answer:0, explanation:"Motion onto ‚Üí Acc.: –Ω–∞ —Å—Ç—ñ–ª."},
    {sentence:"–ú–∏ –∂–∏–≤–µ–º–æ _____ (–ö–∏—ó–≤).", choices:["—É –ö–∏—î–≤—ñ","—É –ö–∏—ó–≤","–¥–æ –ö–∏—î–≤–∞","–Ω–∞ –ö–∏—î–≤—ñ"], answer:0, explanation:"Location in a city ‚Üí —É –ö–∏—î–≤—ñ."},
    {sentence:"–ü–æ—Å—Ç–∞–≤ –ø–ª—è—à–∫—É _____ (—Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫).", choices:["–≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫","—É —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—É","–Ω–∞ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—É","–¥–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞"], answer:0, explanation:"Motion into ‚Üí Acc.: –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫."},
    {sentence:"–ó—É—Å—Ç—Ä—ñ–Ω–µ–º–æ—Å—å _____ (–∑—É–ø–∏–Ω–∫–∞).", choices:["–Ω–∞ –∑—É–ø–∏–Ω—Ü—ñ","–Ω–∞ –∑—É–ø–∏–Ω–∫—É","—É –∑—É–ø–∏–Ω—Ü—ñ","–¥–æ –∑—É–ø–∏–Ω–∫–∏"], answer:0, explanation:"Meeting ‚Äòat‚Äô ‚Üí –Ω–∞ + Loc.: –Ω–∞ –∑—É–ø–∏–Ω—Ü—ñ."}
  ]},
  grammar_genitive_neg: { name:"Grammar ‚Äî Genitive after negation", type:"case", items:[
    {sentence:"–£ –º–µ–Ω–µ –Ω–µ–º–∞—î _____ (—Ö–ª—ñ–±).", choices:["—Ö–ª—ñ–±–∞","—Ö–ª—ñ–±","—Ö–ª—ñ–±–æ–º","—Ö–ª—ñ–±—É"], answer:0, explanation:"After ¬´–Ω–µ–º–∞—î¬ª use Gen.: —Ö–ª—ñ–±–∞."},
    {sentence:"–ù–µ–º–∞—î _____ (–≤–æ–¥a).", choices:["–≤–æ–¥–∏","–≤–æ–¥–∞","–≤–æ–¥–æ—é","–≤–æ–¥—ñ"], answer:0, explanation:"Gen. fem.: –≤–æ–¥–∏."},
    {sentence:"–¢—É—Ç –Ω–µ –±—É–ª–æ _____ (–ª—é–¥–∏).", choices:["–ª—é–¥–µ–π","–ª—é–¥–∏","–ª—é–¥—è–º","–ª—é–¥—å–º–∏"], answer:0, explanation:"Gen. pl.: –ª—é–¥–µ–π."}
  ]},

  cases_nominative: { name:"Grammar ‚Äî Nominative", type:"case", items:[
    {sentence:"_____ ‚Äî —Å—Ç–æ–ª–∏—Ü—è.", choices:["–ö–∏—ó–≤","–ö–∏—î–≤–∞","–ö–∏—î–≤—ñ","–ö–∏—î–≤–æ–º"], answer:0, explanation:"Subject nominative."}
  ]},
  cases_genitive: { name:"Grammar ‚Äî Genitive", type:"case", items:[
    {sentence:"–£ –º–µ–Ω–µ –Ω–µ–º–∞—î _____ (—á–∞—Å).", choices:["—á–∞—Å—É","—á–∞—Å","—á–∞—Å–æ–º","—á–∞—Å—ñ"], answer:0, explanation:"¬´–Ω–µ–º–∞—î¬ª + Gen."}
  ]},
  cases_dative: { name:"Grammar ‚Äî Dative", type:"case", items:[
    {sentence:"–î–∞–π _____ (—è) –≤–æ–¥—É.", choices:["–º–µ–Ω—ñ","–º–µ–Ω–µ","–º–Ω–æ—é","–º–µ–Ω"], answer:0, explanation:"Recipient Dative."}
  ]},
  cases_accusative: { name:"Grammar ‚Äî Accusative", type:"case", items:[
    {sentence:"–Ø —á–∏—Ç–∞—é _____ (–∫–Ω–∏–≥–∞).", choices:["–∫–Ω–∏–≥—É","–∫–Ω–∏–≥–∞","–∫–Ω–∏–≥–∏","–∫–Ω–∏–≥–æ—é"], answer:0, explanation:"Direct object."}
  ]},
  cases_vocative: { name:"Grammar ‚Äî Vocative", type:"case", items:[
    {sentence:"_____, —Ç–∏ –¥–µ?", choices:["–ú–∞–º–æ","–ú–∞–º–∞","–ú–∞–º—ñ","–ú–∞–º–æ—é"], answer:0, explanation:"Addressing."}
  ]},
  grammar_future: { name:"Grammar ‚Äî Future", type:"case", items:[
    {sentence:"–ó–∞–≤—Ç—Ä–∞ —è _____ (—á–∏—Ç–∞—Ç–∏).", choices:["–±—É–¥—É —á–∏—Ç–∞—Ç–∏","–ø—Ä–æ—á–∏—Ç–∞—é","—á–∏—Ç–∞—é","—á–∏—Ç–∞–≤"], answer:0, explanation:"Compound future."}
  ]},
  grammar_aspect: { name:"Grammar ‚Äî Aspect", type:"case", items:[
    {sentence:"–Ø —á–∞—Å—Ç–æ _____ (—á–∏—Ç–∞—Ç–∏).", choices:["—á–∏—Ç–∞—é","–ø—Ä–æ—á–∏—Ç–∞—é","–ø—Ä–æ—á–∏—Ç–∞–≤","–±—É–¥—É —á–∏—Ç–∞—Ç–∏"], answer:0, explanation:"Habit ‚Üí imperf."}
  ]},
  grammar_conjugation: { name:"Grammar ‚Äî Conjugation", type:"case", items:[
    {sentence:"–ú–∏ _____ (—á–∏—Ç–∞—Ç–∏) –≤—Ä–∞–Ω—Ü—ñ.", choices:["—á–∏—Ç–∞—î–º–æ","—á–∏—Ç–∞—Ç–∏","—á–∏—Ç–∞—î–º","—á–∏—Ç—É—î–º–æ"], answer:0, explanation:"1st conj."}
  ]},
  grammar_agreement: { name:"Grammar ‚Äî Agreement", type:"case", items:[
    {sentence:"_____ (–∑–µ–ª–µ–Ω–∞) —Ç—Ä–∞–≤–∞.", choices:["–∑–µ–ª–µ–Ω–∞","–∑–µ–ª–µ–Ω–∏–π","–∑–µ–ª–µ–Ω–µ","–∑–µ–ª–µ–Ω—ñ"], answer:0, explanation:"Adj agrees."}
  ]},
  grammar_gender: { name:"Grammar ‚Äî Noun gender", type:"case", items:[
    {sentence:"–¶–µ –º–æ—î _____ (–º—ñ—Å—Ç–æ).", choices:["–º—ñ—Å—Ç–æ","–º—ñ—Å—Ç–∞","–º—ñ—Å—Ç—É","–º—ñ—Å—Ç–æ–º"], answer:0, explanation:"Neuter nom."}
  ]},
  grammar_questions: { name:"Grammar ‚Äî Questions", type:"case", items:[
    {sentence:"_____ —Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç?", choices:["–ß–∏","–©–æ","–î–µ","–Ø–∫"], answer:0, explanation:"Yes/No ‚Üí —á–∏."}
  ]},
  grammar_negation: { name:"Grammar ‚Äî Negation", type:"case", items:[
    {sentence:"–Ø _____ (–∑–Ω–∞—Ç–∏) –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.", choices:["–Ω–µ –∑–Ω–∞—é","–Ω–µ –∑–Ω–∞—î","–Ω—ñ—á–æ–≥–æ –∑–Ω–∞—é","–Ω—ñ—è–∫–∏–π –∑–Ω–∞—é"], answer:0, explanation:"–Ω–µ + verb."}
  ]},
  grammar_reflexive: { name:"Grammar ‚Äî Reflexive", type:"case", items:[
    {sentence:"–Ø _____ (–º–∏—Ç–∏—Å—è).", choices:["–º–∏—é—Å—è","–º–∏—é","–º–∏—é—Å—å","–º–∏—î—à—Å—è"], answer:0, explanation:"‚Äë—Å—è form."}
  ]},
  grammar_motion: { name:"Grammar ‚Äî Motion", type:"case", items:[
    {sentence:"–Ø –∑–∞—Ä–∞–∑ _____ (–π—Ç–∏) –¥–æ–¥–æ–º—É.", choices:["–π–¥—É","—Ö–æ–¥–∂—É","–ø—ñ–¥—É","–π—à–æ–≤"], answer:0, explanation:"Directional now."}
  ]},
  grammar_word_order: { name:"Grammar ‚Äî Word order", type:"case", items:[
    {sentence:"(–Ø / –π–æ–≥–æ / –Ω–µ / –±–∞—á—É)", choices:["–Ø –π–æ–≥–æ –Ω–µ –±–∞—á—É","–Ø –Ω–µ –±–∞—á—É –π–æ–≥–æ","–ô–æ–≥–æ –Ω–µ –±–∞—á—É —è","–ù–µ —è –±–∞—á—É –π–æ–≥–æ"], answer:0, explanation:"Clitic early; SVO."}
  ]},
  grammar_copula: { name:"Grammar ‚Äî —î/—Ü–µ/‚Äî", type:"case", items:[
    {sentence:"–£ –Ω–∞—Å _____ —á–∞—Å.", choices:["—î","‚Äî","—Ü–µ","–±—É–≤"], answer:0, explanation:"Existence ‚Üí —î."}
  ]},
  grammar_pronouns_cases: { name:"Grammar ‚Äî Pronouns by case", type:"case", items:[
    {sentence:"–í—ñ–Ω –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ _____ (—è).", choices:["–º–µ–Ω–µ","–º–µ–Ω—ñ","–º–Ω–æ—é","–º–µ–Ω"], answer:0, explanation:"Prep + Acc pronoun."}
  ]},
  grammar_comparison: { name:"Grammar ‚Äî Comparison", type:"case", items:[
    {sentence:"–í–∏—â–µ, _____ –±—É–¥–∏–Ω–æ–∫.", choices:["–Ω—ñ–∂","—è–∫","—â–æ","–∫–æ–ª–∏"], answer:0, explanation:"–Ω—ñ–∂ = than."}
  ]},

  /* Extra vocab */
  food_drink_basics: { name:"Food & Drink ‚Äî Basics", type:"vocab", items:[
    {uk:"—Ö–ª—ñ–±", en:"bread"}, {uk:"–≤–æ–¥–∞", en:"water"}, {uk:"—á–∞–π", en:"tea"}, {uk:"–∫–∞–≤–∞", en:"coffee"}
  ]},
  dining_out: { name:"Dining Out", type:"vocab", items:[
    {uk:"–º–µ–Ω—é", en:"menu"}, {uk:"—Ä–∞—Ö—É–Ω–æ–∫, –±—É–¥—å –ª–∞—Å–∫–∞", en:"the bill, please"}, {uk:"–æ—Ñ—ñ—Ü—ñ–∞–Ω—Ç", en:"waiter"}
  ]},
  school_education: { name:"School & Education", type:"vocab", items:[
    {uk:"—à–∫–æ–ª–∞", en:"school"}, {uk:"—É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç", en:"university"}, {uk:"—É—Ä–æ–∫", en:"lesson"}, {uk:"–¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è", en:"homework"}
  ]},
  work_professions: { name:"Work & Professions", type:"vocab", items:[
    {uk:"—Ä–æ–±–æ—Ç–∞", en:"work"}, {uk:"–æ—Ñ—ñ—Å", en:"office"}, {uk:"–∫–æ–ª–µ–≥–∞", en:"colleague"}, {uk:"–ª—ñ–∫–∞—Ä", en:"doctor"}
  ]},
  daily_routines: { name:"Daily Routines", type:"vocab", items:[
    {uk:"–ø—Ä–æ–∫–∏–¥–∞—Ç–∏—Å—è", en:"to wake up"}, {uk:"—Å–Ω—ñ–¥–∞—Ç–∏", en:"to have breakfast"}, {uk:"–ø—Ä–∞—Ü—é–≤–∞—Ç–∏", en:"to work"}
  ]},
  time_calendar: { name:"Time & Calendar", type:"vocab", items:[
    {uk:"—Å—å–æ–≥–æ–¥–Ω—ñ", en:"today"}, {uk:"–∑–∞–≤—Ç—Ä–∞", en:"tomorrow"}, {uk:"–≤—á–æ—Ä–∞", en:"yesterday"}
  ]},
  weather_seasons_plus: { name:"Weather & Seasons ‚Äî Plus", type:"vocab", items:[
    {uk:"–ø—Ä–æ—Ö–æ–ª–æ–¥–Ω–æ", en:"cool"}, {uk:"—Å–ø–µ–∫–æ—Ç–Ω–æ", en:"hot"}, {uk:"—Ö–º–∞—Ä–Ω–æ", en:"cloudy"}
  ]},
  city_transport: { name:"City & Transport", type:"vocab", items:[
    {uk:"–º—ñ—Å—Ç–æ", en:"city"}, {uk:"–∞–≤—Ç–æ–±—É—Å", en:"bus"}, {uk:"–º–µ—Ç—Ä–æ", en:"subway"}
  ]},
  health_body: { name:"Health & Body ‚Äî Adult", type:"vocab", items:[
    {uk:"–ª—ñ–∫–∞—Ä–Ω—è", en:"hospital"}, {uk:"–∞–ø—Ç–µ–∫–∞", en:"pharmacy"}, {uk:"–±–æ–ª—ñ—Ç–∏", en:"to hurt"}
  ]},
  shopping_money: { name:"Shopping & Money", type:"vocab", items:[
    {uk:"–º–∞–≥–∞–∑–∏–Ω", en:"shop"}, {uk:"—Ä–∏–Ω–æ–∫", en:"market"}, {uk:"—Ü—ñ–Ω–∞", en:"price"}
  ]},
  hobbies_sports: { name:"Hobbies & Sports", type:"vocab", items:[
    {uk:"—á–∏—Ç–∞—Ç–∏", en:"to read"}, {uk:"—Å–ª—É—Ö–∞—Ç–∏ –º—É–∑–∏–∫—É", en:"to listen to music"}, {uk:"–±—ñ–≥–∞—Ç–∏", en:"to run"}
  ]},
  technology_basics: { name:"Technology Basics", type:"vocab", items:[
    {uk:"—Ç–µ–ª–µ—Ñ–æ–Ω", en:"phone"}, {uk:"–∫–æ–º–ø'—é—Ç–µ—Ä", en:"computer"}, {uk:"–ø–∞—Ä–æ–ª—å", en:"password"}
  ]},
  house_furniture: { name:"House & Furniture", type:"vocab", items:[
    {uk:"—Å—Ç—ñ–ª", en:"table"}, {uk:"—Å—Ç—ñ–ª–µ—Ü—å", en:"chair"}, {uk:"—à–∞—Ñ–∞", en:"wardrobe"}
  ]},
  people_relationships: { name:"People & Relationships", type:"vocab", items:[
    {uk:"–¥—Ä—É–≥", en:"friend"}, {uk:"—Å—É—Å—ñ–¥", en:"neighbor"}, {uk:"–∫–æ–ª–µ–≥–∞", en:"colleague"}
  ]},
  numbers_21_100: { name:"Numbers 21‚Äì100", type:"vocab", items:[
    {uk:"–¥–≤–∞–¥—Ü—è—Ç—å –æ–¥–∏–Ω", en:"twenty-one"}, {uk:"—Ç—Ä–∏–¥—Ü—è—Ç—å", en:"thirty"}, {uk:"—Å—Ç–æ", en:"one hundred"}
  ]}
});

/* SKILLS ‚Äî expanded path */
const SKILLS = [
  {id:"basics1", name:"Basics 1", emoji:"üî§", decks:["greetings","basics_core","basics_pronouns_q"], tips:`
    <p><strong>What you‚Äôll learn</strong>: greetings, polite phrases, question words, and numbers.</p>
    <ul>
      <li><strong>Articles:</strong> Ukrainian has no ‚Äúa/an/the‚Äù. English answers may include them.</li>
      <li><strong>–±—É–¥—å –ª–∞—Å–∫–∞</strong> = ‚Äúplease‚Äù or ‚Äúyou‚Äôre welcome‚Äù.</li>
      <li><strong>Question words:</strong> —Ö—Ç–æ (who), —â–æ (what), –¥–µ (where), –∫–æ–ª–∏ (when), —á–æ–º—É (why), —è–∫ (how).</li>
      <li><strong>Numbers 1‚Äì20:</strong> 11‚Äì19 end in <em>-–Ω–∞–¥—Ü—è—Ç—å</em>.</li>
    </ul>`},
  {id:"colors_shapes", name:"Colors & Shapes", emoji:"üü•", decks:["colors","shapes"], prereq:["basics1"], tips:`
    <p><strong>Word order:</strong> adjectives usually follow nouns: <em>–∑–µ–ª–µ–Ω–∏–π –º'—è—á</em> (green ball).</p>`},
  {id:"phrases1", name:"Phrases & Travel", emoji:"üí¨", decks:["phrases","travel","time_day"], prereq:["basics1"], tips:`
    <p>Travel questions:</p>
    <ul><li><strong>–î–µ‚Ä¶?</strong> Where ‚Ä¶?</li><li><strong>–°–∫—ñ–ª—å–∫–∏ —Ü–µ –∫–æ—à—Ç—É—î?</strong> How much is this?</li><li><strong>–ß–∏ –º–æ–∂–Ω–∞ –∫–∞—Ä—Ç–∫–æ—é?</strong> Can I pay by card?</li></ul>`},
  {id:"home", name:"Home", emoji:"üè†", decks:["rooms_household","clothes_kid","family"], prereq:["basics1"], tips:`
    <p>Diminuatives for kid‚Äëfriendly speech: <em>–Ω–æ—Å–∏–∫, —Ä–æ—Ç–∏–∫, —Ä—É—á–∫–∞</em>.</p>`},
  {id:"animals", name:"Animals", emoji:"üêæ", decks:["animals_kids","animal_sounds"], prereq:["phrases1"], tips:`
    <p>Fun sounds help memory: <em>–Ω—è–≤-–Ω—è–≤</em> (meow), <em>–≥–∞–≤-–≥–∞–≤</em> (woof).</p>`},
  {id:"body", name:"Body", emoji:"üß∏", decks:["kid_feelings","kid_safety","kid_play","toys_objects","body_kids"], prereq:["home"], tips:`
    <p>Care words for toddlers: <em>–±–æ–ª—è—á–µ?</em>, <em>–æ–±–µ—Ä–µ–∂–Ω–æ</em>.</p>`},
  {id:"kidcare1", name:"Toddler Care", emoji:"üçº", decks:["kid_phrases_caregiver","kid_commands","kid_feeding","kid_diaper","kid_sleep"], prereq:["home"], tips:`
    <p><strong>Imperatives:</strong> use 2sg for one child: <em>–°—ñ–¥–∞–π</em>, <em>–ô–¥–∏</em>.</p>`},
  {id:"seasons", name:"Seasons", emoji:"üå¶Ô∏è", decks:["weather","seasons_months"], prereq:["phrases1"], tips:`<p>Months are masculine; days are lowercase.</p>`},
  {id:"verbs", name:"Verbs & Days", emoji:"üóìÔ∏è", decks:["verbs_basic","days"], prereq:["basics1"], tips:`<p>Present endings: —è -—é/-—É, —Ç–∏ -—î—à, –≤—ñ–Ω/–≤–æ–Ω–∞ -—î‚Ä¶</p>`},
  {id:"grammar1", name:"Grammar 1", emoji:"üìò", decks:["grammar_present","grammar_imperatives","grammar_possessives"], prereq:["basics1"], tips:`
    <p>Build present‚Äëtense patterns and kid‚Äëfriendly commands.</p>`},
  {id:"grammar2", name:"Grammar 2", emoji:"üìô", decks:["grammar_past"], prereq:["grammar1"], tips:`<p>Past marks gender/number.</p>`},
  {id:"grammar3", name:"Cases 1", emoji:"üß©", decks:["cases_basic","cases_instrumental"], prereq:["grammar1"], tips:`<p>Acc, Gen, Dat, Ins basics.</p>`},
  {id:"grammar4", name:"Cases 2", emoji:"üß©", decks:["cases_locative","grammar_prepositions","grammar_genitive_neg"], prereq:["grammar3"], tips:`<p>Location vs motion; Gen after negation.</p>`},
  {id:"food1", name:"Food & Drink 1", emoji:"üçΩÔ∏è", decks:["food_drink_basics","dining_out"], prereq:["basics1"], tips:`<p>Order politely with <em>–±—É–¥—å –ª–∞—Å–∫–∞</em>.</p>`},
  {id:"school1", name:"School & Study", emoji:"üéì", decks:["school_education","time_calendar"], prereq:["basics1"], tips:`<p>Study words + time.</p>`},
  {id:"work1", name:"Work & Office", emoji:"üíº", decks:["work_professions","phrases"], prereq:["phrases1"], tips:`<p>Gendered job titles.</p>`},
  {id:"daily1", name:"Daily Routine", emoji:"‚è∞", decks:["daily_routines","time_day"], prereq:["verbs"], tips:`<p>Describe your day.</p>`},
  {id:"city1", name:"City & Transport", emoji:"üöá", decks:["city_transport","travel"], prereq:["phrases1"], tips:`<p>Tickets & stations.</p>`},
  {id:"health1", name:"Health & Body", emoji:"ü©∫", decks:["health_body","body_kids"], prereq:["home"], tips:`<p>Pharmacy & symptoms.</p>`},
  {id:"shop1", name:"Shopping", emoji:"üõí", decks:["shopping_money","numbers_21_100"], prereq:["basics1"], tips:`<p>Prices and payment.</p>`},
  {id:"hobby1", name:"Hobbies & Sports", emoji:"üèÉ", decks:["hobbies_sports","verbs_basic"], prereq:["basics1"], tips:`<p>Free time talk.</p>`},
  {id:"tech1", name:"Tech Basics", emoji:"üì±", decks:["technology_basics","phrases"], prereq:["phrases1"], tips:`<p>Everyday tech.</p>`},
  {id:"house1", name:"Furniture & Home 2", emoji:"üõãÔ∏è", decks:["house_furniture","rooms_household"], prereq:["home"], tips:`<p>More home words.</p>`},
  {id:"people1", name:"People & Relationships", emoji:"üßë‚Äçü§ù‚Äçüßë", decks:["people_relationships","family"], prereq:["home"], tips:`<p>Social ties.</p>`},
  {id:"grammar5", name:"Cases 3", emoji:"üß©", decks:["cases_nominative","cases_accusative"], prereq:["grammar3"], tips:`<p>Subject vs object.</p>`},
  {id:"grammar6", name:"Cases 4", emoji:"üß©", decks:["cases_dative","cases_genitive"], prereq:["grammar4"], tips:`<p>Dative & genitive.</p>`},
  {id:"grammar7", name:"Cases 5", emoji:"üß©", decks:["cases_vocative"], prereq:["grammar6"], tips:`<p>Addressing (–∫–ª–∏—á–Ω–∏–π).</p>`},
  {id:"grammar8", name:"Future & Aspect", emoji:"‚è≠Ô∏è", decks:["grammar_future","grammar_aspect"], prereq:["grammar2"], tips:`<p>–±—É–¥—É + INF, perf future.</p>`},
  {id:"grammar9", name:"Conjugation & Agreement", emoji:"üß†", decks:["grammar_conjugation","grammar_agreement","grammar_gender"], prereq:["verbs"], tips:`<p>Patterns + agreement.</p>`},
  {id:"grammar10", name:"Questions & Negation", emoji:"‚ùì", decks:["grammar_questions","grammar_negation","grammar_genitive_neg"], prereq:["grammar1"], tips:`<p>—á–∏; negative pronouns.</p>`},
  {id:"grammar11", name:"Reflexives & Motion", emoji:"‚ÜîÔ∏è", decks:["grammar_reflexive","grammar_motion"], prereq:["grammar8"], tips:`<p>‚Äë—Å—è verbs; motion pairs.</p>`},
  {id:"grammar12", name:"Word Order & Copula", emoji:"üß±", decks:["grammar_word_order","grammar_copula"], prereq:["grammar10"], tips:`<p>SVO & —î/—Ü–µ/‚Äî.</p>`},
  {id:"grammar13", name:"Pronouns & Comparison", emoji:"üßæ", decks:["grammar_pronouns_cases","grammar_comparison"], prereq:["grammar12"], tips:`<p>Pronouns by case; –Ω–∞–π‚Äë.</p>`}
];

/* ========================
   TOPBAR & HOME
   ======================== */
function renderTopbar(){ refreshDaily(); $('#tbXP').textContent = profile.xp; $('#tbStreak').textContent = profile.streak; $('#tbHearts').textContent = CURRENT.hearts; }
function renderHomeHero(){
  $('#dailyGoal').textContent = profile.dailyGoal;
  const pct = Math.min(100, Math.round((profile.xpToday/profile.dailyGoal)*100)); const ring = $('#dailyRing'); ring.style.setProperty('--p', pct+'%'); ring.textContent = Math.min(profile.dailyGoal, profile.xpToday);
  try{ buildAlphabetGrid(); }catch(e){}
}
function isUnlocked(skill){ if(!skill.prereq || !skill.prereq.length) return true; return skill.prereq.every(id => skillLevel(id) > 0); }
function nextUnlockedSkill(){ for(const sk of SKILLS){ if(isUnlocked(sk)) return sk; } return SKILLS[0]; }
function renderPath(){
  const path = $('#path'); path.innerHTML = "";
  SKILLS.forEach((sk)=>{
    const node = document.createElement('div'); node.className='skill';
    const lvl = skillLevel(sk.id);
    const locked = !isUnlocked(sk);
    const prereqNames = (sk.prereq||[]).map(x => (SKILLS.find(s=>s.id===x)?.name || x)).join(', ');
    node.innerHTML = `
      <div class="node ${locked?'locked':''}" data-skill="${sk.id}" title="${sk.name}">
        <div class="emoji">${sk.emoji}</div>
        ${lvl>0?`<div class="crown">üëëx${lvl}</div>`:""}
      </div>
      <div class="name">${sk.name}</div>
      <div class="meta">${lvl>0?`Level ${lvl}/3`:(locked?`Locked: ${prereqNames}`:"Unlocked")}</div>
      <div class="start-mini">${locked?'':`<button class="btn blue btnStartSkill" data-skill="${sk.id}">Start</button> <button class="btn ghost btnTips" data-skill="${sk.id}">Tips</button>`}</div>
    `;
    path.appendChild(node);
  });
  $$('.node').forEach(n=> n.addEventListener('click', ()=>{ const id = n.getAttribute('data-skill'); const sk = SKILLS.find(s=>s.id===id); if(!isUnlocked(sk)) return; startLesson(id);}));
  $$('.btnStartSkill').forEach(b=> b.addEventListener('click', (e)=>{ e.stopPropagation(); startLesson(b.getAttribute('data-skill')); }));
  $$('.btnTips').forEach(b=> b.addEventListener('click', (e)=>{ e.stopPropagation(); openTips(b.getAttribute('data-skill')); }));
}

/* ========================
   PRACTICE & LIBRARY
   ======================== */
const GROUPS = {
  toddler: ["kid_phrases_caregiver","kid_commands","kid_feeding","kid_diaper","kid_sleep","kid_play","kid_safety","kid_feelings","body_kids","animals_kids","animal_sounds","toys_objects","clothes_kid","rooms_household"],
  vocab: ["greetings","basics_core","basics_pronouns_q","basics_adjectives","alphabet_ua","numbers","numbers_11_20","colors","shapes","phrases","travel","family","verbs_basic","days","time_day","weather","seasons_months","rooms_household","clothes_kid","toys_objects","animals_kids","animal_sounds","food_drink_basics","dining_out","school_education","work_professions","daily_routines","time_calendar","weather_seasons_plus","city_transport","health_body","shopping_money","hobbies_sports","technology_basics","house_furniture","people_relationships","numbers_21_100"],
  grammar: ["cases_basic","cases_instrumental","cases_locative","grammar_imperatives","grammar_possessives","grammar_present","grammar_past","grammar_prepositions","grammar_genitive_neg","cases_nominative","cases_genitive","cases_dative","cases_accusative","cases_vocative","grammar_future","grammar_aspect","grammar_conjugation","grammar_agreement","grammar_gender","grammar_questions","grammar_negation","grammar_reflexive","grammar_motion","grammar_word_order","grammar_copula","grammar_pronouns_cases","grammar_comparison"]
};
function openLibrary(){
  const list = $('#deckList'); list.innerHTML = "";
  const entries = Object.entries(BUILTIN_DECKS).map(([k,d])=>({key:k, deck:d, count:(d.items||[]).length, mode:d.mode||null})).sort((a,b)=> a.deck.name.localeCompare(b.deck.name));
  const q = normalizeText($('#libSearch').value||"");
  const filtered = q? entries.filter(e=> normalizeText(e.deck.name).includes(q) || normalizeText(e.key).includes(q) ): entries;
  filtered.forEach(e=>{
    const isMedia = e.mode === 'animal-sounds-uk';
    const typeTag = (e.deck.type||'deck').toUpperCase();
    const div = document.createElement('div'); div.className='deck-item';
    // Remove the separate 'Audio' button; use a single primary action labeled 'Start' for all entries
    // Use the shared .btn.blue styling so theme-wide color changes apply uniformly
    div.innerHTML = `<div><strong>${e.deck.name}</strong><div class="muted" style="font-size:.85rem">${typeTag} ‚Ä¢ ${e.count} items</div></div>
      <button class="btn blue" data-mode="${isMedia?'animal-sounds-uk':'play'}" data-key="${e.key}">Start</button>`;
    list.appendChild(div);
  });
  list.querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const key = btn.getAttribute('data-key'); const mode = btn.getAttribute('data-mode'); const deck = BUILTIN_DECKS[key];
      if(mode==='audio'){ startQuickSession({name: (deck?.name||'Deck')+" (Audio)", decks: [key], steps:10, hearts:5, override: 'audio'}); }
      else if(mode==='animal-sounds-uk'){ startQuickSession({name: deck.name, decks: [key], steps: (deck.items||[]).length, hearts:5, override: 'animal-sounds-uk'}); }
      else { startQuickSession({name: deck?.name||'Deck', decks: [key], steps:10, hearts:5, override: null}); }
    });
  });
}
$('#libSearch').addEventListener('input', openLibrary);
$('#libClear').addEventListener('click', ()=>{ $('#libSearch').value=""; openLibrary(); });

/* ========================
   GRAMMAR HUB
   ======================== */
function renderGrammarHub(){
  const list = $('#grammarList'); list.innerHTML="";
  const entries = Object.entries(GRAMMAR_TOPICS).map(([id,t])=>({id, ...t}));
  const q = normalizeText($('#gramSearch').value||"");
  const filtered = q? entries.filter(e=> normalizeText(e.title).includes(q) || normalizeText(e.html).includes(q) || (e.decks||[]).join(' ').includes(q) ): entries;
  filtered.forEach(t=>{
    const card=document.createElement('div'); card.className='card';
    card.innerHTML = `<div class="title">üìò ${t.title}</div>
      <div class="muted">Short lesson with examples.</div>
      <div class="small">${(t.decks&&t.decks.length)?`Covers: ${t.decks.join(', ')}`:`General reference`}</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button class="btn" data-id="${t.id}" data-action="open">Open</button>
        ${(t.decks&&t.decks.length)?`<button class="btn blue" data-id="${t.id}" data-action="practice">Practice this</button>`:""}
      </div>`;
    list.appendChild(card);
  });
  list.querySelectorAll('button').forEach(b=>{
    b.addEventListener('click', ()=>{
      const id=b.getAttribute('data-id'); const act=b.getAttribute('data-action');
      if(act==='open'){ openGrammarPanel(id); }
      else if(act==='practice'){ const decks=GRAMMAR_TOPICS[id].decks||[]; if(decks.length){ startQuickSession({name:`Grammar: ${GRAMMAR_TOPICS[id].title}`, decks: decks, steps:10, hearts:5}); } }
    });
  });
}
$('#gramSearch').addEventListener('input', renderGrammarHub);
$('#gramClear').addEventListener('click', ()=>{ $('#gramSearch').value=""; renderGrammarHub(); });

/* ========================
   LESSON GENERATION
   ======================== */
function decksForSkill(id){ const sk = SKILLS.find(s=>s.id===id); if(!sk) return []; return sk.decks.map(k=>deckByKey(k)).filter(Boolean); }
function sampleFromDeckKeys(keys, count){
  try{
    const pool = keys.flatMap(k => (deckByKey(k)?.items||[]).map(it=>({...it, __deck: deckByKey(k), __deckKey: k})));
    return shuffle(pool).filter(Boolean).slice(0, Math.min(count, pool.length));
  }catch(e){ console.error(e); return []; }
}
function sampleItemsForSkill(id, count){
  try{
    const decks = decksForSkill(id);
    const pool = decks.flatMap(d=> (d?.items||[]).map(it=>({...it, __deck:d})));
    return shuffle(pool).filter(Boolean).slice(0, Math.min(count, pool.length));
  }catch(e){ console.error(e); return []; }
}
function topicForDeckKey(deckKey){
  if(deckKey==="cases_nominative") return "nominative";
  if(deckKey==="cases_genitive") return "genitive";
  if(deckKey==="cases_dative") return "dative";
  if(deckKey==="cases_accusative") return "accusative";
  if(deckKey==="cases_vocative") return "vocative";
  if(deckKey==="grammar_future") return "future";
  if(deckKey==="grammar_aspect") return "aspect";
  if(deckKey==="grammar_conjugation") return "conjugation_breakdown";
  if(deckKey==="grammar_agreement") return "agreement";
  if(deckKey==="grammar_gender") return "gender_basics";
  if(deckKey==="grammar_questions") return "questions_answers";
  if(deckKey==="grammar_negation") return "negation_full";
  if(deckKey==="grammar_reflexive") return "reflexive_sya";
  if(deckKey==="grammar_motion") return "motion_verbs";
  if(deckKey==="grammar_word_order") return "word_order";
  if(deckKey==="grammar_copula") return "copula_je";
  if(deckKey==="grammar_pronouns_cases") return "pronouns_cases";
  if(deckKey==="grammar_comparison") return "comparison";

  if(!deckKey) return "translation_basics";
  if(deckKey.startsWith("grammar_present")) return "present";
  if(deckKey.startsWith("grammar_past")) return "past";
  if(deckKey.startsWith("grammar_imperatives") || deckKey==="kid_commands") return "imperatives";
  if(deckKey.startsWith("grammar_possessives")) return "possessives";
  if(deckKey.startsWith("cases_")) return "cases_overview";
  if(deckKey==="cases_instrumental") return "instrumental";
  if(deckKey==="cases_locative") return "locative";
  if(deckKey==="grammar_prepositions") return "prepositions_motion";
  if(deckKey==="grammar_genitive_neg") return "genitive_negation";
  return "translation_basics";
}

/* ---- Special builder for Animal Sounds (answers in Ukrainian) ---- */
function buildAnimalSoundTask(item, fromDeckKey){
  // Correct answer = Ukrainian onomatopoeia (e.g., '–º—É-—É')
  const all = (deckByKey(fromDeckKey)?.items || []);
  const distract = [];
  for(const w of shuffle(all)){
    const uk = w.uk;
    if(uk!==item.uk && !distract.includes(uk)){ distract.push(uk); if(distract.length>=3) break; }
  }
  const options = shuffle([item.uk, ...distract.slice(0,2)]); // 3 options total
  return {
    kind:'mc',
    direction:'animal-sound',
    prompt:'Tap the animal, then choose its sound (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é)',
    options,
    answer: item.uk,
    speak: item.uk, // Use TTS
    media: 'animal',
    imageEmoji: item.emoji,
    topic:'translation_basics'
  };
}

function buildMC_UK_EN(item){
  const en = primaryEn(item.en);
  const distractPool = Object.values(BUILTIN_DECKS).filter(d=>d.type==='vocab').flatMap(d=>d.items.map(x=>primaryEn(x.en)));
  const distract = shuffle(distractPool).filter(x=>x!==en).slice(0,3);
  return { kind:'mc', prompt:item.uk, direction:'uk-en', options: shuffle([en, ...distract]), answer: en, speak: item.uk, topic: topicForDeckKey(item.__deckKey) };
}
function buildMC_EN_UK(item){
  const uk = item.uk;
  const pool = Object.values(BUILTIN_DECKS).filter(d=>d.type==='vocab').flatMap(d=>d.items.map(x=>x.uk));
  const distract = []; for(const w of shuffle(pool)){ if(normalizeText(w)!==normalizeText(uk) && !distract.some(z=>normalizeText(z)===normalizeText(w))){ distract.push(w); if(distract.length>=3) break; } }
  return { kind:'mc', prompt: primaryEn(item.en), direction:'en-uk', options: shuffle([uk, ...distract]), answer: uk, speak: null, topic: topicForDeckKey(item.__deckKey) };
}
function genTaskFromItem(item, overrideMode=null){
  if(!item) return null;
  if(overrideMode==='animal-sounds-uk' || item.__deckKey==='animal_sounds_media'){
    return buildAnimalSoundTask(item, item.__deckKey);
  }
  if(item.__deck?.type==='case'){
    const q = item;
    const topic = topicForDeckKey(item.__deckKey||"");
    return { kind:'mcg', prompt:q.sentence, options: q.choices.map(c=>c), answerIndex:q.answer, explain:q.explanation||"", speak: q.sentence.replace("_____", "‚Ä¶"), topic };
  }
  if(overrideMode==='audio'){ return buildMC_UK_EN(item); }
  if(overrideMode==='en-uk-mc'){ return buildMC_EN_UK(item); }
  const rnd = Math.random();
  if(rnd < .5){
    return buildMC_UK_EN(item);
  }else if(rnd < .85){
    const ansTokens = tokeniseEN(item.en);
    const fillers = shuffle(["a","the","is","are","to","with","and","in","at","please","now","my","your","this","that"]);
    const bank = shuffle([...ansTokens, ...fillers.slice(0, Math.max(2, 6-ansTokens.length))]);
    return { kind:'wb', prompt:item.uk, direction:'uk-en', bank, answerTokens: ansTokens, speak: item.uk, topic: topicForDeckKey(item.__deckKey) };
  }else{
    return buildMC_EN_UK(item);
  }
}
function safeBuildTasks(base, steps, override){
  return shuffle(base).filter(Boolean).map(it => genTaskFromItem(it, override)).filter(Boolean).slice(0, steps);
}
function buildLessonFromSkill(skillId, steps=10){
  CURRENT.skillId = skillId; CURRENT.hearts = 5; CURRENT.stepsTotal = steps; CURRENT.stepsDone = 0; CURRENT.correct = 0; CURRENT.wrong = 0; CURRENT.modeOverride = null; CURRENT.quickDeckKeys=null; CURRENT.results = [];
  const base = sampleItemsForSkill(skillId, 24);
  base.forEach(it=> { if(it) it.__deckKey = Object.entries(BUILTIN_DECKS).find(([k,d])=> d===it.__deck)?.[0] || ""; });
  CURRENT.tasks = safeBuildTasks(base, steps, null);
  if(CURRENT.tasks.length===0){
    const seed = sampleFromDeckKeys(["greetings","basics_core","basics_pronouns_q"], 24);
    CURRENT.tasks = safeBuildTasks(seed, steps, null);
  }
  CURRENT.idx = 0;
}
function startQuickSession({name, decks, steps=10, hearts=5, override=null}){
  CURRENT.skillId = "__quick__"; CURRENT.quickName = name; CURRENT.quickDeckKeys = decks; CURRENT.hearts = hearts; CURRENT.stepsTotal = steps; CURRENT.stepsDone = 0; CURRENT.correct = 0; CURRENT.wrong = 0; CURRENT.modeOverride = override; CURRENT.results = [];
  const base = sampleFromDeckKeys(decks, 36);
  CURRENT.tasks = safeBuildTasks(base, steps, override);
  if(CURRENT.tasks.length===0){
    const seed = sampleFromDeckKeys(["greetings","basics_core","basics_pronouns_q"], 24);
    CURRENT.tasks = safeBuildTasks(seed, steps, override);
  }
  CURRENT.idx = 0;
  setView('#lesson');
  renderSegments(); renderHearts(); renderTask();
  $('#lessonTitle').textContent = name;
}

/* ========================
   RENDER: LESSON
   ======================== */
function setView(id){
  $$('.view').forEach(v=>v.classList.remove('active'));
  $(id).classList.add('active');
  $$('.tab').forEach(b=> b.classList.remove('active'));
  if(id==='#home') $('#tabHome').classList.add('active');
  if(id==='#practice') $('#tabPractice').classList.add('active');
  if(id==='#library') $('#tabLibrary').classList.add('active');
  if(id==='#grammar') $('#tabGrammar').classList.add('active');
  // close mobile nav if open
  try{ document.body.classList.remove('nav-open'); const nt = document.getElementById('btnNavToggle'); if(nt) nt.setAttribute('aria-expanded','false'); }catch(e){}
}
function renderHearts(){ const wrap = $('#hearts'); wrap.innerHTML = ""; for(let i=0;i<5;i++){ const d = document.createElement('div'); d.className = 'h '+(i<CURRENT.hearts?'on':''); wrap.appendChild(d); } $('#tbHearts').textContent = CURRENT.hearts; }
function renderSegments(){
  const wrap = $('#segments'); wrap.innerHTML = "";
  const res = Array.isArray(CURRENT.results) ? CURRENT.results : [];
  for(let i=0;i<CURRENT.stepsTotal;i++){
    const seg = document.createElement('div'); seg.className = 'seg';
    if(i < res.length){ seg.classList.add(res[i] ? 'done' : 'fail'); }
    wrap.appendChild(seg);
  }
}
function showInfo(msg){
  const fb = $('#feedback'); fb.style.display='block'; fb.className='feedback info'; fb.innerHTML = `<strong>Heads up:</strong> <span class="muted">${msg}</span>`;
}
let checking=false;
function renderTask(){
  try{
    renderSegments(); renderHearts();
    const title = CURRENT.skillId==="__quick__" ? (CURRENT.quickName||"Practice") : (SKILLS.find(s=>s.id===CURRENT.skillId)?.name || "Lesson");
    $('#lessonTitle').textContent = title;
    $('#feedback').style.display='none'; $('#feedback').className='feedback'; $('#btnCheck').disabled = true; $('#btnIDK').disabled = false; checking=false;
    const bc=$('#btnCheck'); if(bc){ bc.textContent='Check'; bc.classList.remove('red'); bc.classList.add('primary'); bc.dataset.mode='check'; }
    const t = CURRENT.tasks[CURRENT.idx];
    if(!t){ $('#promptLabel').textContent="Loading task‚Ä¶"; $('#mcWrap').innerHTML=""; $('#wbWrap').style.display='none'; $('#mediaArea').innerHTML=""; return; }
    $('#subtitle').textContent = t.direction==='uk-en' ? 'Translate to English' : t.direction==='en-uk' ? 'Choose the Ukrainian translation' : (t.direction==='animal-sound'?'Tap the animal, then choose its sound':'Choose the correct form');
    $('#speakBtn').style.display = '';
    const __spk = getSpeakText(t);
    $('#speakBtn').onclick = ()=> speak(__spk); $('#promptLabel').innerHTML = t.prompt;

    const media = $('#mediaArea'); media.innerHTML = "";
    if(t.media==='animal' && t.imageEmoji){
      const card = document.createElement('button');
      card.className = 'animalBtn';
      card.setAttribute('aria-label','Play animal sound');
      card.textContent = t.imageEmoji;
      card.addEventListener('click', ()=> speak(t.speak||''));
      media.appendChild(card);
      const hint = document.createElement('div'); hint.className='animalHint'; hint.textContent = 'Tap the animal to hear the sound (Ukrainian onomatopoeia)';
      media.appendChild(hint);
    }

    $('#mcWrap').style.display='none'; $('#wbWrap').style.display='none'; $('#mcWrap').innerHTML = "";
    if(t.kind==='wb'){
      $('#wbWrap').style.display='block'; const ans = $('#wbAnswer'); const bank = $('#wbBank'); ans.innerHTML=""; bank.innerHTML="";
      t.bank.forEach(tok=>{ const chip=document.createElement('button'); chip.className='chip'; chip.textContent=tok;
        chip.addEventListener('click', ()=>{ chip.classList.add('used'); const pick=document.createElement('button'); pick.className='chip'; pick.textContent=tok; pick.addEventListener('click', ()=>{ pick.remove(); chip.classList.remove('used'); checkWBEnable(); }); ans.appendChild(pick); checkWBEnable(); });
        bank.appendChild(chip);
      });
      function checkWBEnable(){ const count = $$('#wbAnswer .chip').length; $('#btnCheck').disabled = count===0; }
    }else{
      $('#mcWrap').style.display='grid';
      const opts = t.options || [];
      opts.forEach((opt)=>{
        const b = document.createElement('button'); b.className='opt'; b.textContent = opt;
        b.addEventListener('click', ()=>{ $$('#mcWrap .opt').forEach(x=>x.classList.remove('selected')); b.classList.add('selected'); b.dataset.sel='1'; $('#btnCheck').disabled=false; });
        $('#mcWrap').appendChild(b);
      });
    }
  }catch(e){
    console.error(e); toast("Reloading task‚Ä¶");
    if(CURRENT.idx < CURRENT.tasks.length-1){ CURRENT.idx++; renderTask(); }
    else{ startQuickSession({name:"Practice ‚Äî fallback", decks:["greetings","basics_core"], steps:6, hearts:5}); }
  }
}
function checkAnswer(){
  const bc=$('#btnCheck'); const mode=(bc&&bc.dataset&&bc.dataset.mode)||'check';
  if(mode==='continue'||mode==='gotit'){ nextStep(); return; }
  if(mode==='end'){ endLesson(false); return; }
  if(checking) return; checking=true; $('#btnCheck').disabled=true; $('#btnIDK').disabled=true;
  try{
    const t = CURRENT.tasks[CURRENT.idx];
    if(!t){ const bc=$('#btnCheck'); bc.textContent='CONTINUE'; bc.classList.remove('red'); bc.classList.add('primary'); bc.disabled=false; bc.dataset.mode='continue'; checking=false; return; }
    let correct=false, show="", explain="";

    if(t.kind==='wb'){
      const picked = $$('#wbAnswer .chip').map(x=>x.textContent);
      if(picked.length===0){ showInfo("Tap words to build your answer first."); $('#btnIDK').disabled=false; checking=false; return; }
      const target = t.answerTokens; correct = sameText(picked.join(' '), target.join(' ')); show = target.join(' ');
    }else if(t.kind==='mc'){
      const sel = $$('#mcWrap .opt').find(x=>x.classList.contains('selected'));
      if(!sel){ showInfo("Please select an option first."); $('#btnIDK').disabled=false; checking=false; return; }
      correct = sameText(sel.textContent, t.answer);
      $$('#mcWrap .opt').forEach(b=>{ const good = sameText(b.textContent, t.answer); if(good) b.classList.add('correct'); if(b===sel && !good) b.classList.add('wrong'); });
      show = t.answer;
    }else if(t.kind==='mcg'){
      const sel = $$('#mcWrap .opt').find(x=>x.classList.contains('selected'));
      if(!sel){ showInfo("Please choose a form."); $('#btnIDK').disabled=false; checking=false; return; }
      const idx = t.options.findIndex(o => sameText(o, sel.textContent));
      correct = idx === t.answerIndex; explain = t.explain||"";
      $$('#mcWrap .opt').forEach(b=>{ const good = sameText(b.textContent, t.options[t.answerIndex]); if(good) b.classList.add('correct'); if(b===sel && !good) b.classList.add('wrong'); });
      show = t.options[t.answerIndex];
    }else{
      $('#btnIDK').disabled=false; checking=false; idk(); return;
    }

    $('#feedback').style.display='block';
    if(correct){
      $('#feedback').classList.remove('bad','info'); $('#feedback').classList.add('good');
      $('#feedback').innerHTML = `<strong>Correct!</strong> ${explain?`<span class="muted">‚Äî ${explain}</span>`:""}`;
      CURRENT.correct++; beep(true); markSegment(true);
      const bc=$('#btnCheck'); bc.textContent='CONTINUE'; bc.classList.remove('red'); bc.classList.add('primary'); bc.disabled=false; bc.dataset.mode='continue'; checking=false;
    }else{
      $('#feedback').classList.remove('good','info'); $('#feedback').classList.add('bad');
      $('#feedback').innerHTML = `<strong>Not quite.</strong> ${show?`<span class="muted">Answer: ${show}</span>`:""} ${explain?`<div class="muted">${explain}</div>`:""}`;
      CURRENT.wrong++; CURRENT.hearts = Math.max(0, CURRENT.hearts-1); beep(false); renderHearts(); markSegment(false);
      if(CURRENT.hearts===0){ const bc=$('#btnCheck'); bc.textContent='GOT IT'; bc.classList.remove('primary'); bc.classList.add('red'); bc.disabled=false; bc.dataset.mode='end'; checking=false; return; }
      const bc=$('#btnCheck'); bc.textContent='GOT IT'; bc.classList.remove('primary'); bc.classList.add('red'); bc.disabled=false; bc.dataset.mode='gotit'; checking=false;
    }
  }catch(e){
    console.error(e);
    const t = CURRENT.tasks && CURRENT.tasks[CURRENT.idx];
    let show = "";
    try{
      if(t){
        if(t.kind==='mc'){ show = t.answer; }
        else if(t.kind==='mcg'){ show = (t.options||[])[t.answerIndex]; }
        else if(t.kind==='wb'){ show = (t.answerTokens||[]).join(' '); }
      }
    }catch(_){}
    $('#feedback').style.display='block'; $('#feedback').className='feedback bad';
    $('#feedback').innerHTML = `<strong>Something went wrong on this one.</strong> ${show?`<span class="muted">Answer: ${show}</span>`:""}`;
    CURRENT.wrong++; CURRENT.hearts = Math.max(0, CURRENT.hearts-1); renderHearts(); markSegment(false);
    const bc=$('#btnCheck');
    if(CURRENT.hearts===0){ bc.textContent='GOT IT'; bc.classList.remove('primary'); bc.classList.add('red'); bc.disabled=false; bc.dataset.mode='end'; }
    else { bc.textContent='GOT IT'; bc.classList.remove('primary'); bc.classList.add('red'); bc.disabled=false; bc.dataset.mode='gotit'; }
    checking=false;
  }
}
function markSegment(ok){
  if(!Array.isArray(CURRENT.results)) CURRENT.results = [];
  CURRENT.results[CURRENT.stepsDone] = !!ok;
  const seg = $$('#segments .seg')[CURRENT.stepsDone];
  if(seg){ seg.classList.remove('done','fail'); seg.classList.add(ok ? 'done' : 'fail'); }
}
function nextStep(){ CURRENT.stepsDone++; if(CURRENT.stepsDone >= CURRENT.stepsTotal){ endLesson(true); return; } CURRENT.idx++; renderTask(); }
function idk(){
  const t = CURRENT.tasks[CURRENT.idx]; CURRENT.hearts = Math.max(0, CURRENT.hearts-1); renderHearts();
  $('#feedback').style.display='block'; $('#feedback').classList.remove('good','info'); $('#feedback').classList.add('bad');
  const show = t && (t.kind==='mc' ? t.answer : t.kind==='mcg' ? t.options[t.answerIndex] : t.kind==='wb' ? t.answerTokens.join(' ') : "");
  $('#feedback').innerHTML = `<strong>Skipped.</strong> <span class="muted">Answer: ${show||""}</span>`;
  markSegment(false); if(CURRENT.hearts===0){ const bc=$('#btnCheck'); bc.textContent='GOT IT'; bc.classList.remove('primary'); bc.classList.add('red'); bc.disabled=false; bc.dataset.mode='end'; return; }
  const bc=$('#btnCheck'); bc.textContent='GOT IT'; bc.classList.remove('primary'); bc.classList.add('red'); bc.disabled=false; bc.dataset.mode='gotit';
}

/* ========================
   In‚Äëlesson Grammar Panel
   ======================== */
function getTopicContent(id){
  const t = GRAMMAR_TOPICS[id] || GRAMMAR_TOPICS.translation_basics;
  return { id, title: t.title, html: t.html, decks: t.decks||[] };
}
function openGrammarPanel(topicId){
  const gp = $('#gpanel'); const body = $('#gpBody'); const title = $('#gptitle');
  const {id, title: ttitle, html, decks} = getTopicContent(topicId||'translation_basics');
  title.textContent = ttitle;
  body.innerHTML = `${html}`;
  gp.classList.add('open'); gp.setAttribute('aria-hidden','false'); gp.dataset.topic = id;
  const btn = $('#gpPractice'); if(decks && decks.length){ btn.disabled=false; btn.onclick = ()=> startQuickSession({name:`Grammar: ${ttitle}`, decks: decks, steps:10, hearts:5}); } else { btn.disabled=true; btn.onclick = null; }
}
function closeGrammarPanel(){
  const gp = $('#gpanel'); gp.classList.remove('open'); gp.setAttribute('aria-hidden','true'); gp.dataset.topic="";
}
$('#gpClose').addEventListener('click', closeGrammarPanel);
$('#gpOpenHub').addEventListener('click', ()=>{ closeGrammarPanel(); setView('#grammar'); });
$('#btnOpenGrammar').addEventListener('click', ()=>{
  const gp = $('#gpanel');
  const isOpen = gp.classList.contains('open');
  if(isOpen){
    closeGrammarPanel();
  } else {
    const t = CURRENT.tasks[CURRENT.idx];
    const topic = t && t.topic ? t.topic : 'translation_basics';
    openGrammarPanel(topic);
  }
});
document.addEventListener('keydown', (e)=>{ if((e.key||'').toLowerCase()==='g'){ const isOpen = $('#gpanel').classList.contains('open'); if(isOpen) closeGrammarPanel(); else { const t = CURRENT.tasks[CURRENT.idx]; const topic = t && t.topic ? t.topic : 'translation_basics'; openGrammarPanel(topic); } } });

/* ========================
   END / SUMMARY / TIPS
   ======================== */
function endLesson(completed){
  setTimeout(()=>{
    setView('#summary'); const pass = completed && CURRENT.hearts>0; const xp = pass ? 12 : 5;
    $('#sumXP').textContent = xp; $('#sumMsg').textContent = pass ? "Great job!" : "Lesson over";
    $('#sumCorrect').textContent = CURRENT.correct; $('#sumTotal').textContent = CURRENT.stepsTotal; $('#sumHearts').textContent = CURRENT.hearts;
    addXP(xp); if(pass && CURRENT.skillId!=="__quick__"){ completeSkill(CURRENT.skillId); } renderPath();
  }, 300);
}
function openTips(skillId){ const sk = SKILLS.find(s=>s.id===skillId); const more = `<div class="tipbox" style="margin-top:10px"><strong>Open during lessons:</strong> use the <em>üß† Grammar</em> button (or press <kbd>G</kbd>) for context help.</div>`; $('#tipsTitle').textContent = `${sk?.name||'Tips'} ‚Äî Tips`; $('#tipsBody').innerHTML = (sk?.tips || "<p class='muted'>No tips yet.</p>")+more; setView('#tips'); }

/* ========================
   NAV EVENTS
   ======================== */
$('#tabHome').addEventListener('click', ()=> setView('#home'));
$('#tabPractice').addEventListener('click', ()=> { setView('#practice'); });
$('#tabGrammar').addEventListener('click', ()=> { setView('#grammar'); renderGrammarHub(); });
$('#tabLibrary').addEventListener('click', ()=> { setView('#library'); openLibrary(); });

function startNext(){ try{ const sk = nextUnlockedSkill(); startLesson(sk.id); }catch(e){ console.error(e); toast("Starting fallback lesson"); startQuickSession({name:"Quick Start", decks:["greetings","basics_core"], steps:8, hearts:5}); } }
$('#btnStartNext').addEventListener('click', startNext);
$('#heroStart').addEventListener('click', startNext);

$('#btnToddler').addEventListener('click', ()=> startQuickSession({name:"Toddler Mode", decks: GROUPS.toddler, steps:10, hearts:5, override:'audio'}));
$('#btnVocab').addEventListener('click', ()=> startQuickSession({name:"Vocab Drill", decks: GROUPS.vocab, steps:10, hearts:5}));
$('#btnAudio').addEventListener('click', ()=> startQuickSession({name:"Audio Drill", decks: GROUPS.vocab, steps:10, hearts:5, override:'audio'}));
$('#btnReading').addEventListener('click', ()=> startQuickSession({name:"EN‚ÜíUK (MC)", decks: GROUPS.vocab, steps:10, hearts:5, override: 'en-uk-mc'}));
$('#btnGrammar').addEventListener('click', ()=> startQuickSession({name:"Grammar Review", decks: GROUPS.grammar, steps:10, hearts:5}));
$('#btnMixed').addEventListener('click', ()=> startQuickSession({name:"Mixed Review", decks: [...GROUPS.vocab, ...GROUPS.grammar], steps:10, hearts:5}));

$('#btnIDK').addEventListener('click', idk);
$('#btnCheck').addEventListener('click', checkAnswer);
$('#btnToHome').addEventListener('click', ()=> setView('#home'));
$('#btnRedo').addEventListener('click', ()=> {
  if(CURRENT.skillId==="__quick__"){
    startQuickSession({name: CURRENT.quickName, decks: CURRENT.quickDeckKeys || GROUPS.vocab, steps: CURRENT.stepsTotal, hearts:5, override: CURRENT.modeOverride});
  } else { startLesson(CURRENT.skillId); }
});
$('#btnNextSkill').addEventListener('click', ()=>{ const i = SKILLS.findIndex(s=>s.id===CURRENT.skillId); const next = SKILLS.slice(i+1).find(isUnlocked); if(next) startLesson(next.id); else setView('#home'); });
$('#btnTips').addEventListener('click', ()=> openTips(CURRENT.skillId));
$('#btnBackFromTips').addEventListener('click', ()=> setView('#home'));

/* ========================
   LESSON STARTERS
   ======================== */
function startLesson(skillId){
  try{
    buildLessonFromSkill(skillId, 10);
    setView('#lesson');
    renderSegments(); renderHearts(); renderTask(); renderTopbar();
  }catch(e){
    console.error(e); toast("Starting fallback lesson");
    startQuickSession({name:"Quick Start", decks:["greetings","basics_core"], steps:8, hearts:5});
  }
}

/* ========================
   INIT
   ======================== */
(function init(){
  try{ primeTTS(); }catch(e){}

  try{
    refreshDaily(); renderTopbar(); renderHomeHero(); renderPath(); renderGrammarHub(); openLibrary();
  }catch(e){
    console.error(e);
  }
})();

// Theme toggle: apply, persist, and label
function applyTheme(theme){
  const root = document.documentElement;
  root.setAttribute('data-theme', theme);
  try{ localStorage.setItem('theme', theme); }catch(_){ /* ignore */ }
  const btn = document.getElementById('btnThemeToggle');
  if(btn && !btn.classList.contains('logo-badge')){
    btn.textContent = theme==='dark' ? 'Dark' : 'Light';
  }
}
(function initTheme(){
  let theme = 'light';
  try{ theme = localStorage.getItem('theme') || 'light'; }catch(_){ theme = 'light'; }
  applyTheme(theme);
  const btn = document.getElementById('btnThemeToggle');
  if(btn){ btn.addEventListener('click', ()=> applyTheme((document.documentElement.getAttribute('data-theme')==='dark')?'light':'dark')); }
})();

/* Mobile nav toggle wiring: allows a small "‚ò∞" button to show/hide the tabbar and stats on narrow screens */
(function initNavToggle(){
  try{
    const navToggle = document.getElementById('btnNavToggle');
    if(!navToggle) return;
    navToggle.addEventListener('click', (e)=>{ e.stopPropagation(); const open = document.body.classList.toggle('nav-open'); navToggle.setAttribute('aria-expanded', open ? 'true' : 'false'); });
    // Close nav when a tab is selected
    $$('.tab').forEach(t=> t.addEventListener('click', ()=> { document.body.classList.remove('nav-open'); navToggle.setAttribute('aria-expanded','false'); }));
    // Close nav if clicking outside the nav area
    document.addEventListener('click', (e)=>{
      const tb = document.querySelector('.tabbar'); if(!tb) return;
      if(document.body.classList.contains('nav-open') && !(e.target instanceof Element && (tb.contains(e.target) || navToggle.contains(e.target)))){
        document.body.classList.remove('nav-open'); navToggle.setAttribute('aria-expanded','false');
      }
    });
  }catch(e){ /* non-critical */ }
})();

/* Mobile bottom nav: auto-show on mobile widths and wire buttons */
(function initMobileBottomNav(){
  try{
    const mq = window.matchMedia('(max-width:700px)');
    const rootBody = document.body;
    const nav = document.getElementById('mobileBottomNav');
    function updateForMobile(){
      const isMobile = mq.matches;
      if(isMobile){ rootBody.classList.add('is-mobile'); if(nav) nav.setAttribute('aria-hidden','false'); }
      else { rootBody.classList.remove('is-mobile'); if(nav) nav.setAttribute('aria-hidden','true'); }
      // ensure nav-toggle is not shown (we're automatic)
      const nt = document.getElementById('btnNavToggle'); if(nt) nt.style.display = 'none';
      updateActiveNav();
    }
    mq.addEventListener ? mq.addEventListener('change', updateForMobile) : (mq.addListener && mq.addListener(updateForMobile));
    function updateActiveNav(){
      const view = $$('.view').find(v=> v.classList.contains('active'))?.id || 'home';
      $$('#mobileBottomNav .nav-btn').forEach(b=> b.classList.remove('active'));
      const sel = $(`#mobileBottomNav .nav-btn[data-view='#${view}']`);
      if(sel) sel.classList.add('active');
    }
    if(nav){
      nav.querySelectorAll('.nav-btn').forEach(b=>{
        b.addEventListener('click', ()=>{
          const v = b.getAttribute('data-view'); if(v){ setView(v); updateActiveNav(); }
        });
      });
    }
    // close any open nav-open state
    document.body.classList.remove('nav-open');
    updateForMobile();
  }catch(e){ /* ignore if not supported */ }
})();
</script>
</body>
</html>
